<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>BY DevOps | ä»Šæ™šæ‰“è€è™</title>
  <meta name="author" content="æ—æ–‡æ°">
  
  <meta name="description" content="DevOps æŠ€æœ¯è¿ç»´å°å­¦ç”Ÿ">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="BY DevOps | ä»Šæ™šæ‰“è€è™">

  
    <meta property="og:image" content="undefined">
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>
</html>
 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">BY DevOps | ä»Šæ™šæ‰“è€è™</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header">
  <h1>è®°å½•Linuxçš„ç‚¹ç‚¹æ»´æ»´ï¼ˆDevOpsæŠ€æœ¯è¿ç»´å°å­¦ç”Ÿï¼‰</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      Welcome to my blog.
</div>    

		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2019-02-18 </div>
			<div class="article-title"><a href="/2019/02/18/Dockerå¦‚ä½•æ¨é€é•œåƒåˆ°Harborï¼Ÿ/">Dockerå¦‚ä½•æ¨é€é•œåƒåˆ°Harborï¼Ÿ</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <h3 id="ç™»å½•">ç™»å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 harbor]# docker login -u admin -p Harbor12345  http://10.80.80.251</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">Error response from daemon: Get https://10.80.80.251/v2/: read tcp 10.80.80.251:50374-&gt;10.80.80.251:443: read: connection reset by peer</span><br></pre></td></tr></table></figure>
<h6 id="åŸå› å¦‚ä¸‹ï¼š">åŸå› å¦‚ä¸‹ï¼š</h6><p>docker é»˜è®¤ä½¿ç”¨httpsï¼Œå¦‚æœä»“åº“ä½¿ç”¨äº†httpï¼Œåˆ™è¦ä¿®æ”¹ä¸‹Dockerçš„é…ç½®:/etc/docker/daemon.json, æ·»åŠ å‚æ•°insecure-registries:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 harbor]#  cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  "registry-mirrors": ["https://v5d7kh0f.mirror.aliyuncs.com"],</span><br><span class="line">  "insecure-registries": ["10.80.80.251"]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> é‡å¯docker</span><br><span class="line">[root@node1 harbor]# systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> é‡å¯åç™»å½•</span><br><span class="line">[root@node1 harbor]# docker login -u admin -p Harbor12345  http://10.80.80.251</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure></p>
<h3 id="æŸ¥çœ‹é•œåƒåˆ—è¡¨">æŸ¥çœ‹é•œåƒåˆ—è¡¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 harbor]# docker images</span><br><span class="line">REPOSITORY                                                                         TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line"></span><br><span class="line">gcr.io/google_containers/cluster-proportional-autoscaler-amd64                     1.3.0               33813c948942        3 months ago        45.8MB</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/ringtail/cluster-proportional-autoscaler-amd64   v1.3.0              33813c948942        3 months ago        45.8MB</span><br><span class="line">cr.io/google_containers/cluster-proportional-autoscaler-amd64                      1.3.0               33813c948942        3 months ago        45.8MB</span><br><span class="line">google_containers/cluster-proportional-autoscaler-amd64                            1.3.0               33813c948942        3 months ago        45.8MB</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚éœ€è¦æŠŠ registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 ä¸Šä¼ åˆ°horbarä»“åº“ï¼Œåˆ™æ­¥æ“å¦‚ä¸‹ï¼š</p>
<h4 id="1ã€æ‰“tag">1ã€æ‰“tag</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag registry.cn-hangzhou.aliyuncs.com/ringtail/cluster-proportional-autoscaler-amd64:v1.3.0 10.80.80.251/google_containers/cluster-proportional-autoscaler-amd64:1.3.0</span><br></pre></td></tr></table></figure>
<h4 id="2ã€ç™»å½•">2ã€ç™»å½•</h4><p>çœ‹å¼€å¤´ä¸Šæ–‡</p>
<h4 id="3ã€PUSH(éœ€è¦æå‰åœ¨Horbaræ–°å¢é¡¹ç›®google_containers)">3ã€PUSH(éœ€è¦æå‰åœ¨Horbaræ–°å¢é¡¹ç›®google_containers)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 harbor]# docker push   10.80.80.251/google_containers/cluster-proportional-autoscaler-amd64:1.3.0</span><br><span class="line">The push refers to repository [10.80.80.251/google_containers/cluster-proportional-autoscaler-amd64]</span><br><span class="line">a636ea940e54: Pushed </span><br><span class="line">1.3.0: digest: sha256:4fd37c5b29a38b02c408c56254bd1a3a76f3e236610bc7a8382500bbf9ecfc76 size: 528</span><br></pre></td></tr></table></figure>

	
	</div>
	
  
</div>
	<a type="button" href="/2019/02/18/Dockerå¦‚ä½•æ¨é€é•œåƒåˆ°Harborï¼Ÿ/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2019-02-18 </div>
			<div class="article-title"><a href="/2019/02/18/å¦‚ä½•æ­å»ºé«˜å¯ç”¨Docker-Harborä»“åº“/">å¦‚ä½•æ­å»ºé«˜å¯ç”¨Docker Harborä»“åº“</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <h3 id="ä¸€ã€é¦–å…ˆæ¢ç©¶Dockerä»“åº“åˆ†ç±»?">ä¸€ã€é¦–å…ˆæ¢ç©¶Dockerä»“åº“åˆ†ç±»?</h3><ul>
<li>1ã€å…¬æœ‰ä»“åº“(docker hubã€é˜¿é‡Œäº‘ä»“åº“ã€ç½‘æ˜“äº‘ä»“åº“ç­‰)</li>
<li>2ã€ç§æœ‰ä»“åº“(harborã€docker-registry)</li>
</ul>
<p>Docker-registryæ˜¯å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ„å»ºç§æœ‰çš„é•œåƒä»“åº“ã€‚Harboræ˜¯ç”±VMwareå›¢é˜Ÿè´Ÿè´£å¼€å‘çš„å¼€æºä¼ä¸šçº§Docker Registryï¼Œ</p>
<h3 id="äºŒã€What_is_Harbor?">äºŒã€What is Harbor?</h3><blockquote>
<p>Harbor is an open source cloud native registry that stores, signs, and scans container images for vulnerabilities.</p>
<p>Harbor solves common challenges by delivering trust, compliance, performance, and interoperability. It fills a gap for organizations and applications that cannot use a public or cloud-based registry, or want a consistent experience across clouds.</p>
</blockquote>
<h3 id="ä¸‰ã€é¦–å…ˆä»‹ç»ä¸‹Horbarç»„ä»¶">ä¸‰ã€é¦–å…ˆä»‹ç»ä¸‹Horbarç»„ä»¶</h3><p> <img src="/img/201902/harbor01.png" style="width: 550x;"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒHarboråŒ…å«6ä¸ªç»„ä»¶ï¼š</p>
<ul>
<li><p><strong>Proxyï¼š</strong> Harborçš„ç»„ä»¶ï¼Œä¾‹å¦‚æ³¨å†Œè¡¨ï¼ŒUIå’Œä»¤ç‰ŒæœåŠ¡ï¼Œéƒ½åœ¨åå‘ä»£ç†ä¹‹åã€‚ä»£ç†å°†æ¥è‡ªæµè§ˆå™¨å’ŒDockerå®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘ç»™å„ç§åç«¯æœåŠ¡ã€‚</p>
</li>
<li><p><strong>Registryï¼š</strong> è´Ÿè´£å­˜å‚¨Dockeré•œåƒå’Œå¤„ç†Docker pull/pushå‘½ä»¤ã€‚ç”±äºHarboréœ€è¦å¯¹å›¾åƒå¼ºåˆ¶å®æ–½è®¿é—®æ§åˆ¶ï¼Œå› æ­¤Registryä¼šå°†å®¢æˆ·ç«¯å®šå‘åˆ°tokenï¼Œä»¥è·å–æ¯ä¸ªpull/pushæœ‰æ•ˆçš„tokenã€‚</p>
</li>
<li><p><strong>Core servicesï¼š</strong> horbarçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸»è¦æä¾›ä»¥ä¸‹æœåŠ¡ï¼š</p>
<ul>
<li>UIï¼š ä¸€ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·ç®¡ç†Registry;</li>
<li>Webhook: æ˜¯ä¸€ç§åœ¨Registryä¸­é…ç½®çš„æœºåˆ¶ï¼Œå› æ­¤å¯ä»¥å°†Registryä¸­çš„å›¾åƒçŠ¶æ€æ›´æ”¹å¡«å……åˆ°Harborçš„Webhookç«¯ç‚¹ã€‚Harborä½¿ç”¨webhookæ›´æ–°æ—¥å¿—ï¼Œå¯åŠ¨å¤åˆ¶å’Œå…¶ä»–ä¸€äº›åŠŸèƒ½;</li>
<li>Tokenï¼šè´Ÿè´£æ ¹æ®ç”¨æˆ·çš„é¡¹ç›®è§’è‰²ä¸ºæ¯ä¸ªdocker push / pullå‘½ä»¤å‘å‡ºä»¤ç‰Œã€‚å¦‚æœä»Dockerå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™æ³¨å†Œè¡¨ä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°ä»¤ç‰ŒæœåŠ¡ï¼›</li>
</ul>
</li>
<li><p><strong>Databaseï¼š</strong> æ•°æ®åº“å­˜å‚¨é¡¹ç›®ï¼Œç”¨æˆ·ï¼Œè§’è‰²ï¼Œå¤åˆ¶ç­–ç•¥å’Œå›¾åƒçš„å…ƒæ•°æ®ã€‚</p>
</li>
<li><p><strong>Job servicesï¼š</strong> ç”¨äºå›¾åƒå¤åˆ¶ï¼Œæœ¬åœ°å›¾åƒå¯ä»¥å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰åˆ°å…¶ä»–Harborå®ä¾‹ã€‚</p>
</li>
<li><p><strong>Log collectorï¼š</strong> è´Ÿè´£æ”¶é›†å…¶ä»–æ¨¡å—çš„æ—¥å¿—ã€‚</p>
</li>
</ul>
<h3 id="å››ã€Dockerç™»é™†è¿‡ç¨‹">å››ã€Dockerç™»é™†è¿‡ç¨‹</h3><p> <img src="/img/201902/harbor02.png" style="width: 550x;"></p>
<ul>
<li><p>ï¼ˆaï¼‰é€šè¿‡ç«¯å£80ç›‘å¬çš„ä»£ç†å®¹å™¨æ¥æ”¶è¯¥è¯·æ±‚ã€‚å®¹å™¨ä¸­çš„Nginxå°†è¯·æ±‚è½¬å‘ç»™åç«¯çš„Registryå®¹å™¨ã€‚</p>
</li>
<li><p>ï¼ˆbï¼‰æ³¨å†Œè¡¨å®¹å™¨å·²é…ç½®ä¸ºåŸºäºtokençš„èº«ä»½éªŒè¯ï¼Œå¦‚æœéªŒè¯å¤±è´¥å°†ä¼šè¿”å›é”™è¯¯ä»£ç 401ï¼Œé€šçŸ¥Dockerå®¢æˆ·ç«¯ä»æŒ‡å®šçš„URLè·å–æœ‰æ•ˆtokenã€‚åœ¨Harborä¸­ï¼Œæ­¤URLæŒ‡å‘Core Servicesçš„tokenæœåŠ¡;</p>
</li>
<li><p>ï¼ˆcï¼‰å½“Dockerå®¢æˆ·ç«¯æ”¶åˆ°é”™è¯¯ä»£ç æ—¶ï¼Œå®ƒä¼šå‘tokenæœåŠ¡URLå‘é€è¯·æ±‚ï¼Œæ ¹æ®HTTPè§„èŒƒçš„åŸºæœ¬èº«ä»½éªŒè¯åœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Šç”¨æˆ·åå’Œå¯†ç ;</p>
</li>
<li><p>ï¼ˆdï¼‰åœ¨é€šè¿‡ç«¯å£80å°†è¯¥è¯·æ±‚å‘é€åˆ°ä»£ç†å®¹å™¨ä¹‹åï¼ŒNginxå†æ¬¡æ ¹æ®é¢„å…ˆé…ç½®çš„è§„åˆ™å°†è¯·æ±‚è½¬å‘åˆ°UIå®¹å™¨ã€‚UIå®¹å™¨å†…çš„tokenæœåŠ¡æ¥æ”¶è¯·æ±‚ï¼Œè§£ç è¯·æ±‚å¹¶è·å–ç”¨æˆ·åå’Œå¯†ç ;</p>
</li>
<li><p>ï¼ˆeï¼‰è·å–ç”¨æˆ·åå’Œå¯†ç åï¼ŒtokenæœåŠ¡æ£€æŸ¥æ•°æ®åº“å¹¶é€šè¿‡MySqlæ•°æ®åº“ä¸­çš„æ•°æ®å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸ºLDAP / ADèº«ä»½éªŒè¯é…ç½®tokenæœåŠ¡æ—¶ï¼Œå®ƒå°†å‘å¤–éƒ¨LDAP / ADæœåŠ¡å™¨å‘èµ·è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚èº«ä»½éªŒè¯æˆåŠŸåï¼ŒtokenæœåŠ¡å°†è¿”å›æŒ‡ç¤ºæˆåŠŸçš„HTTPä»£ç ã€‚HTTPå“åº”ä¸»ä½“åŒ…å«ç”±ç§é’¥ç”Ÿæˆçš„tokenã€‚</p>
</li>
</ul>
<h3 id="äº”ã€Harboré«˜å¯ç”¨æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ">äº”ã€Harboré«˜å¯ç”¨æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</h3><blockquote>
<p>åœ¨æ—¥å¸¸ç»´æŠ¤ä¸­ï¼Œä»“åº“å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œå¯è°“ååˆ†é‡è¦ã€‚å½“ç”Ÿäº§ä»“åº“å½“å®•æœºåï¼Œè€Œä¸èƒ½å¿«é€Ÿæ¢å¤æ—¶å€™ï¼Œå¯¹å¼€å‘å’Œä¸šåŠ¡å½±å“ç”šå¤§ï¼Œå»ºè®®åœ¨æ—¥å¸¸è¿ç»´ä¸­é‡‡å–ç›¸å¯¹é«˜å¯ç”¨æ–¹æ¡ˆï¼Œæœ€èµ·ç ä¿è¯æ•°ä¸ä¼šä¸¢å¤±ã€‚</p>
<h4 id="Harboré«˜å¯ç”¨å¯åŒ…æ‹¬ä»¥ä¸‹æ–¹æ¡ˆï¼š">Harboré«˜å¯ç”¨å¯åŒ…æ‹¬ä»¥ä¸‹æ–¹æ¡ˆï¼š</h4><ul>
<li>å¤šå®ä¾‹å…±äº«åç«¯å­˜å‚¨(é‡‡å–æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ–¹å¼)<br><img src="/img/201902/harbor03.png" style="width: 550x;"></li>
</ul>
</blockquote>
<ul>
<li>å¤šå®ä¾‹ç›¸äº’æ•°æ®åŒæ­¥(åŸºäºé•œåƒå¤åˆ¶æ¨¡å¼)</li>
</ul>
<h3 id="å…­ã€Horbarå®‰è£…ä¸é…ç½®">å…­ã€Horbarå®‰è£…ä¸é…ç½®</h3><h4 id="6-1ã€å®‰è£…æ–¹å¼">6.1ã€å®‰è£…æ–¹å¼</h4><ul>
<li><strong>åœ¨çº¿ä¸‹è½½å®‰è£…ï¼š</strong> å®‰è£…ç¨‹åºä»Docker hubä¸‹è½½Harborçš„é•œåƒ</li>
<li><strong>ç¦»çº¿è„±æœºå®‰è£…ï¼š</strong> å½“ä¸»æœºä¸èƒ½ä¸Šç½‘æ—¶å€™å¯ä½¿ç”¨æ­¤å®‰è£…ç¨‹åº</li>
</ul>
<p>å»ºè®®ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆç¦»çº¿è„±æœºå®‰è£…ï¼Œç›¸å…³ç¨‹åºåŒ…ä¸‹è½½åœ°å€ä¸ºï¼š<a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases</a></p>
<blockquote>
<p>åŸºç¡€ç¯å¢ƒ</p>
<ul>
<li><strong>ç³»ç»Ÿç‰ˆæœ¬ï¼š</strong> CentOS Linux release 7.4.1708 (Core)</li>
<li><strong>Harborç‰ˆæœ¬ï¼š</strong> harbor-offline-installer-v1.7.1.tgz</li>
</ul>
</blockquote>
<p>æ³¨æ„ï¼šå®‰è£…å‰éœ€è¦å®‰è£…Compose</p>
<h4 id="6-2ã€åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…Compose">6.2ã€åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…Compose</h4><h5 id="6-2-1_è¿è¡Œæ­¤å‘½ä»¤ä»¥ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Docker_Composeï¼š">6.2.1 è¿è¡Œæ­¤å‘½ä»¤ä»¥ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Docker Composeï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
<h5 id="6-2-2_å¯¹äºŒè¿›åˆ¶æ–‡ä»¶åº”ç”¨å¯æ‰§è¡Œæƒé™ï¼š">6.2.2 å¯¹äºŒè¿›åˆ¶æ–‡ä»¶åº”ç”¨å¯æ‰§è¡Œæƒé™ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœdocker-composeå®‰è£…åå‘½ä»¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥è·¯å¾„ã€‚æ‚¨è¿˜å¯ä»¥åˆ›å»º/usr/binè·¯å¾„ä¸­çš„ç¬¦å·é“¾æ¥æˆ–ä»»ä½•å…¶ä»–ç›®å½•ã€‚<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose <span class="regexp">/usr/</span>bin<span class="regexp">/docker-compose</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="6-2-3_éªŒè¯ï¼š">6.2.3 éªŒè¯ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node1 harbor]# docker-compose version </span><br><span class="line">docker-compose version 1.23.2, build 1110ad01</span><br><span class="line">docker-py version: 3.6.0</span><br><span class="line">CPython version: 3.6.7</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0f  25 May 2017</span><br></pre></td></tr></table></figure>
<h4 id="6-3_é…ç½®å‚æ•°">6.3 é…ç½®å‚æ•°</h4><p>horbaré…ç½®å‚æ•°ä½äºæ–‡ä»¶harbor.cfgä¸­ï¼Œåœ¨harbor.cfgä¸­æœ‰ä¸¤ç±»å‚æ•°ï¼Œ</p>
<ul>
<li><strong>å¿…éœ€å‚æ•°ï¼š</strong> éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è¿™äº›å‚æ•°ã€‚å¦‚æœç”¨æˆ·æ›´æ–°å®ƒä»¬harbor.cfgå¹¶è¿è¡Œinstall.shè„šæœ¬ä»¥é‡æ–°å®‰è£…Harborï¼Œå®ƒä»¬å°†ç”Ÿæ•ˆã€‚</li>
<li><strong>å¯é€‰å‚æ•°ï¼š</strong> è¿™äº›å‚æ•°å¯¹äºæ›´æ–°æ˜¯å¯é€‰çš„ï¼Œå³ç”¨æˆ·å¯ä»¥å°†å®ƒä»¬ä¿ç•™ä¸ºé»˜è®¤å€¼ï¼Œå¹¶åœ¨å¯åŠ¨Harbourååœ¨Web Portalä¸Šæ›´æ–°å®ƒä»¬ã€‚å¦‚æœå®ƒä»¬å·²ç»å¯ç”¨harbor.cfgï¼Œå®ƒä»¬åªä¼šåœ¨é¦–æ¬¡å¯åŠ¨Harbouræ—¶ç”Ÿæ•ˆã€‚harbor.cfgå°†å¿½ç•¥å¯¹è¿™äº›å‚æ•°çš„åç»­æ›´æ–°ã€‚</li>
</ul>
<p>é‡è¦çš„å‡ ä¸ªå‚æ•°ï¼ˆå¦‚éœ€è¦ç”¨åˆ°å…¶å®ƒå‚æ•°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰</p>
<ul>
<li><strong>hostnameï¼š</strong> ç›®æ ‡ä¸»æœºçš„ä¸»æœºåï¼Œä¸å»ºè®®ä½¿ç”¨localhostæˆ–127.0.0.1ä½œä¸ºä¸»æœºå </li>
<li><strong>ui_url_protocolï¼š</strong> è®¿é—®ä½¿ç”¨åè®®ä¸ºhttpæˆ–https,é»˜è®¤ä¸ºhttp</li>
<li><strong>db_passwordï¼š</strong> ç”¨äºdb_authçš„PostgreSQLæ•°æ®åº“çš„rootå¯†ç </li>
<li><strong>max_job_workersï¼š</strong> (é»˜è®¤å€¼ä¸º10ï¼‰ä½œä¸šæœåŠ¡ä¸­çš„æœ€å¤§å¤åˆ¶å·¥ä½œæ•°</li>
<li><strong>ssl_certï¼š</strong> SSLè¯ä¹¦çš„è·¯å¾„ï¼Œä»…åœ¨åè®®è®¾ç½®ä¸ºhttpsæ—¶åº”ç”¨</li>
<li><strong>ssl_cert_keyï¼š</strong> SSLå¯†é’¥çš„è·¯å¾„ï¼Œä»…åœ¨åè®®è®¾ç½®ä¸ºhttpsæ—¶åº”ç”¨</li>
<li><strong>harbor_admin_passwordï¼š</strong> ç®¡ç†å‘˜çš„åˆå§‹å¯†ç ã€‚æ­¤å¯†ç ä»…åœ¨Harboré¦–æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆã€‚ä¹‹åï¼Œå°†å¿½ç•¥æ­¤è®¾ç½®ï¼Œå¹¶ä¸”åº”åœ¨Portalä¸­è®¾ç½®ç®¡ç†å‘˜å¯†ç ã€‚è¯·æ³¨æ„ï¼Œé»˜è®¤ç”¨æˆ·å/å¯†ç ä¸ºadmin / Harbor12345</li>
<li><strong>auth_modeï¼š</strong> ä½¿ç”¨çš„èº«ä»½éªŒè¯ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯db_auth</li>
</ul>
<h4 id="6-4_å®‰è£…harbor">6.4 å®‰è£…harbor</h4><h5 id="6-4-1_æ¨èç¦»çº¿å®‰è£…">6.4.1 æ¨èç¦»çº¿å®‰è£…</h5><h6 id="ä¸‹è½½ç¨‹åºåŒ…ï¼šhttps://github-com/goharbor/harbor/releases">ä¸‹è½½ç¨‹åºåŒ…ï¼š<a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases</a></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.1.tgz</span><br></pre></td></tr></table></figure>
<h6 id="å»ºè®®ä½¿ç”¨httpså¢åŠ å®‰å…¨æ€§">å»ºè®®ä½¿ç”¨httpså¢åŠ å®‰å…¨æ€§</h6><p>ç”±äºHarboræœªé™„å¸¦ä»»ä½•è¯ä¹¦ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨HTTPæ¥æä¾›æ³¨å†Œè¡¨è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå¼ºçƒˆå»ºè®®ä¸ºä»»ä½•ç”Ÿäº§ç¯å¢ƒå¯ç”¨å®‰å…¨æ€§ã€‚Harboræœ‰ä¸€ä¸ªNginxå®ä¾‹ä½œä¸ºæ‰€æœ‰æœåŠ¡çš„åå‘ä»£ç†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨prepareè„šæœ¬é…ç½®Nginxä»¥å¯ç”¨httpsã€‚</p>
<p>åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œè€Œä¸æ˜¯æ¥è‡ªå—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹CAçš„è¯ä¹¦ã€‚ä»¥ä¸‹å†…å®¹å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºè‡ªå·±çš„CAï¼Œå¹¶ä½¿ç”¨æ‚¨çš„CAç­¾ç½²æœåŠ¡å™¨è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚</p>
<h6 id="è·å¾—è¯ä¹¦æˆæƒ">è·å¾—è¯ä¹¦æˆæƒ</h6><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.<span class="type">key</span> <span class="number">4096</span></span><br><span class="line">openssl req -x509 -new -nodes -sha512 -days <span class="number">3650</span> \</span><br><span class="line">  -subj <span class="string">"/C=TW/ST=Taipei/L=Taipei/O=example/OU=Personal/CN=yourdomain.com"</span> \</span><br><span class="line">  -<span class="type">key</span> ca.<span class="type">key</span> \</span><br><span class="line">  -out ca.crt</span><br></pre></td></tr></table></figure>
<h5 id="è·å¾—æœåŠ¡å™¨è¯ä¹¦">è·å¾—æœåŠ¡å™¨è¯ä¹¦</h5><p>å‡è®¾æ‚¨çš„æ³¨å†Œè¡¨çš„ä¸»æœºåæ˜¯yourdomain.comï¼Œå¹¶ä¸”å…¶DNSè®°å½•æŒ‡å‘æ‚¨æ­£åœ¨è¿è¡ŒHarborçš„ä¸»æœºã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‚¨é¦–å…ˆåº”è¯¥ä»CAè·å¾—è¯ä¹¦ã€‚åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„CA. è¯ä¹¦é€šå¸¸åŒ…å«.crtæ–‡ä»¶å’Œ.keyæ–‡ä»¶ï¼Œä¾‹å¦‚yourdomain.com.crtå’Œyourdomain.com.keyã€‚</p>
<ul>
<li><p>1ï¼‰åˆ›å»ºè‡ªå·±çš„ç§é’¥ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out yourdomain<span class="selector-class">.com</span><span class="selector-class">.key</span> <span class="number">4096</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2ï¼‰ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼š</p>
</li>
</ul>
<p>å¦‚æœæ‚¨ä½¿ç”¨åƒyourdomain.comè¿™æ ·çš„FQDN è¿æ¥æ³¨å†Œè¡¨ä¸»æœºï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»ä½¿ç”¨yourdomain.comä½œä¸ºCNï¼ˆé€šç”¨åç§°ï¼‰ã€‚<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req -sha512 -new \</span><br><span class="line">  -subj <span class="string">"/C=TW/ST=Taipei/L=Taipei/O=example/OU=Personal/CN=yourdomain.com"</span> \</span><br><span class="line">  -key yourdomain<span class="selector-class">.com</span><span class="selector-class">.key</span> \</span><br><span class="line">  -out yourdomain<span class="selector-class">.com</span><span class="selector-class">.csr</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>3ï¼‰ç”Ÿæˆæ³¨å†Œè¡¨ä¸»æœºçš„è¯ä¹¦ï¼š</li>
</ul>
<p>æ— è®ºæ‚¨æ˜¯ä½¿ç”¨ç±»ä¼¼yourdomain.comçš„ FQDN è¿˜æ˜¯IPæ¥è¿æ¥æ³¨å†Œè¡¨ä¸»æœºï¼Œè¯·è¿è¡Œæ­¤å‘½ä»¤ä»¥ç”Ÿæˆç¬¦åˆä¸»é¢˜å¤‡ç”¨åç§°ï¼ˆSANï¼‰å’Œx509 v3æ‰©å±•è¦æ±‚çš„æ³¨å†Œè¡¨ä¸»æœºè¯ä¹¦ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; v3<span class="selector-class">.ext</span> &lt;&lt;-EOF</span><br><span class="line">authorityKeyIdentifier=keyid,issuer</span><br><span class="line">basicConstraints=CA:FALSE</span><br><span class="line">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="line">extendedKeyUsage = serverAuth </span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[alt_names]</span><br><span class="line">DNS.<span class="number">1</span>=yourdomain.com</span><br><span class="line">DNS.<span class="number">2</span>=yourdomain</span><br><span class="line">DNS.<span class="number">3</span>=hostname</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">  openssl x509 -req -sha512 -days <span class="number">3650</span> \</span><br><span class="line">    -extfile v3<span class="selector-class">.ext</span> \</span><br><span class="line">    -CA ca<span class="selector-class">.crt</span> -CAkey ca<span class="selector-class">.key</span> -CAcreateserial \</span><br><span class="line">    -<span class="keyword">in</span> yourdomain<span class="selector-class">.com</span><span class="selector-class">.csr</span> \</span><br><span class="line">    -out yourdomain<span class="selector-class">.com</span><span class="selector-class">.crt</span></span><br></pre></td></tr></table></figure>
<h5 id="6-4-2_é…ç½®harbor">6.4.2 é…ç½®harbor</h5><p>å¤åˆ¶è¯ä¹¦å’Œå¯†é’¥(å»ºè®®ä½¿ç”¨å¤–ç½‘åŸŸåè´­ä¹°çš„è¯ä¹¦,docker pull/push é»˜è®¤èµ°https)<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp yourdomain<span class="selector-class">.com</span><span class="selector-class">.crt</span> /data/cert/</span><br><span class="line">cp yourdomain<span class="selector-class">.com</span><span class="selector-class">.key</span> /data/cert/</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hostname</span> = <span class="number">192.168</span>.<span class="number">0.6</span></span><br><span class="line"><span class="attr">ui_url_protocol</span> = https</span><br><span class="line"><span class="attr">ssl_cert</span> = /data/cert/yourdomain.com.crt</span><br><span class="line"><span class="attr">ssl_cert_key</span> = /data/cert/yourdomain.com.key</span><br></pre></td></tr></table></figure></p>
<p>ä¸ºHarborç”Ÿæˆé…ç½®æ–‡ä»¶<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./<span class="built_in">prepare</span></span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…harbor<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./<span class="keyword">install</span>.sh</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœå®‰è£…è¿‡ç¨‹å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼Œè¯·ç¡®è®¤Docker Composeæ˜¯å¦å®‰è£…æˆåŠŸï¼<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ– Need to install docker-compose(1.7.1+) by yourself first and run this script again.</span><br></pre></td></tr></table></figure></p>
<h5 id="6-4-3_å¦‚å¤–æ¥pgé…ç½®ï¼Œæ–°ç‰ˆæš‚æ—¶ä¸æ”¯æŒmysqlï¼ˆhttps://github-com/goharbor/harbor/issues/6534_ï¼‰">6.4.3 å¦‚å¤–æ¥pgé…ç½®ï¼Œæ–°ç‰ˆæš‚æ—¶ä¸æ”¯æŒmysqlï¼ˆ<a href="https://github.com/goharbor/harbor/issues/6534" target="_blank" rel="noopener">https://github.com/goharbor/harbor/issues/6534</a> ï¼‰</h5><h5 id="harbor-cfgé…ç½®å¦‚ä¸‹ï¼š">harbor.cfgé…ç½®å¦‚ä¸‹ï¼š</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db_host</span> = <span class="number">192.168</span>.<span class="number">32.18</span></span><br><span class="line"><span class="attr">db_password</span> = password</span><br><span class="line"><span class="attr">db_port</span> = <span class="number">5432</span></span><br><span class="line"><span class="attr">db_user</span> = harbor</span><br></pre></td></tr></table></figure>
<h6 id="å®‰è£…å’Œé…ç½®">å®‰è£…å’Œé…ç½®</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> https://download.postgresql.org/pub/repos/yum/<span class="number">10</span>/redhat/rhel<span class="number">-7</span>-x86_64/pgdg-centos10<span class="number">-10</span><span class="number">-1.</span>noarch.rpm</span><br><span class="line"><span class="comment">#å®‰è£…å®¢æˆ·ç«¯</span></span><br><span class="line">yum <span class="keyword">install</span> postgresql10</span><br><span class="line"><span class="comment">#å®‰è£…æœåŠ¡ç«¯</span></span><br><span class="line">yum <span class="keyword">install</span> postgresql10-<span class="keyword">server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆå§‹åŒ–å’Œå¯åŠ¨</span></span><br><span class="line">postgresql-setup initdb</span><br><span class="line">systemctl <span class="keyword">enable</span> postgresql.service</span><br><span class="line">systemctl <span class="keyword">start</span> postgresql.service</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å¯å‚è€ƒï¼š<a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="noopener">https://www.postgresql.org/download/linux/redhat/</a></p>
<h6 id="åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“">åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE registry;</span><br><span class="line">CREATE USER harbor  WITH PASSWORD 'password';</span><br><span class="line">CREATE DATABASE registry OWNER harbor;</span><br><span class="line">GRANT ALL PRIVILEGES ON DATABASE registry to harbor;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ postgresql.conf</span></span><br><span class="line">listen_addresses = '*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹pg_hba.conf</span></span><br><span class="line">host  all  all 0.0.0.0/0 md5</span><br></pre></td></tr></table></figure>
<h5 id="è¸©å‘è®°å½•">è¸©å‘è®°å½•</h5><h6 id="è¸©å‘ä¹‹ä¸€ï¼šç”¨æˆ·ç•Œé¢æ— æ³•ç™»é™†">è¸©å‘ä¹‹ä¸€ï¼šç”¨æˆ·ç•Œé¢æ— æ³•ç™»é™†</h6><p>è§£å†³ï¼š<br>1ã€docker ps å‘ç°harbor-adminserver ä¸æ–­é‡å¯<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bf880eb451cd </span>       goharbor/harbor-adminserver:<span class="built_in">v1</span>.<span class="number">7</span>.<span class="number">1</span>       <span class="string">"/harbor/start.sh"</span>       <span class="number">48</span> seconds ago      Restarting (<span class="number">1</span>) <span class="number">17</span> secons ago                                                                         harbor-adminserver</span><br></pre></td></tr></table></figure></p>
<p>2ã€æŸ¥çœ‹æ—¥å¿—å‘ç°ä»¥ä¸‹<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Jan</span> <span class="selector-tag">30</span> <span class="selector-tag">08</span><span class="selector-pseudo">:48</span><span class="selector-pseudo">:29</span> <span class="selector-tag">172</span><span class="selector-class">.22</span><span class="selector-class">.0</span><span class="selector-class">.1</span> <span class="selector-tag">adminserver</span><span class="selector-attr">[64872]</span>: <span class="selector-tag">2019-01-30T00</span><span class="selector-pseudo">:48</span><span class="selector-pseudo">:29Z</span> <span class="selector-attr">[INFO]</span> <span class="selector-tag">the</span> <span class="selector-tag">path</span> <span class="selector-tag">of</span> <span class="selector-tag">key</span> <span class="selector-tag">used</span> <span class="selector-tag">by</span> <span class="selector-tag">key</span> <span class="selector-tag">provider</span>: /<span class="selector-tag">etc</span>/<span class="selector-tag">adminserverkey</span></span><br><span class="line"><span class="selector-tag">Jan</span> <span class="selector-tag">30</span> <span class="selector-tag">08</span><span class="selector-pseudo">:48</span><span class="selector-pseudo">:29</span> <span class="selector-tag">172</span><span class="selector-class">.22</span><span class="selector-class">.0</span><span class="selector-class">.1</span> <span class="selector-tag">adminserver</span><span class="selector-attr">[64872]</span>: <span class="selector-tag">2019-01-30T00</span><span class="selector-pseudo">:48</span><span class="selector-pseudo">:29Z</span> <span class="selector-attr">[FATAL]</span> <span class="selector-attr">[main.go:45]</span>: <span class="selector-tag">failed</span> <span class="selector-tag">to</span> <span class="selector-tag">initialize</span> <span class="selector-tag">the</span> <span class="selector-tag">system</span>: <span class="selector-tag">read</span> /<span class="selector-tag">tc</span>/<span class="selector-tag">adminserver</span>/<span class="selector-tag">key</span>: <span class="selector-tag">is</span> <span class="selector-tag">a</span> <span class="selector-tag">directory</span></span><br></pre></td></tr></table></figure></p>
<p>3ã€ç”±äºä¿®æ”¹äº†secretkey_path in harbor.cfgï¼Œå¹¶æ²¡æœ‰æ›´æ”¹docker-compose.ymlé…ç½®å¯¼è‡´ï¼Œä¿®æ”¹ådocker-compose.ymlæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="meta">down</span></span><br><span class="line">./prepare</span><br><span class="line">docker-compose <span class="meta">up</span> -d</span><br></pre></td></tr></table></figure></p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://github.com/goharbor/harbor/wiki/Architecture-Overview-of-Harbor" target="_blank" rel="noopener">https://github.com/goharbor/harbor/wiki/Architecture-Overview-of-Harbor</a></li>
<li><a href="https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md" target="_blank" rel="noopener">https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md</a></li>
<li><a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="noopener">https://www.postgresql.org/download/linux/redhat/</a></li>
<li><a href="https://github.com/goharbor/harbor/issues/6534" target="_blank" rel="noopener">https://github.com/goharbor/harbor/issues/6534</a></li>
</ul>

	
	</div>
	
  
</div>
	<a type="button" href="/2019/02/18/å¦‚ä½•æ­å»ºé«˜å¯ç”¨Docker-Harborä»“åº“/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2019-02-17 </div>
			<div class="article-title"><a href="/2019/02/17/Pythonè°ƒç”¨Jenkins-api-æ–‡æ¡£/">Pythonè°ƒç”¨Jenkins api æ–‡æ¡£</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <h3 id="1ã€å¼•è¨€ï¼š">1ã€å¼•è¨€ï¼š</h3><p>ç°é˜¶æ®µå¤§éƒ¨åˆ†å…¬å¸ï¼Œåœ¨æ—¥å¸¸è¿ç»´ä¸­ä½¿ç”¨jenkinsé¢‘ç‡è¿˜æ˜¯ç›¸å¯¹å¤šï¼Œä»Šå¤©æˆ‘ä»¬ç®€å•æ¢è®¨ä¸‹jenkins apiçš„ä½¿ç”¨ã€‚</p>
<h3 id="2ã€Pythonåº“">2ã€Pythonåº“</h3><h4 id="2-1ã€python-jenkins">2.1ã€python-jenkins</h4><p>python-jenkinså®˜æ–¹é“¾æ¥ï¼š<br><a href="http://python-jenkins.readthedocs.io/en/latest/examples.html#example-1-get-version-of-jenkins" target="_blank" rel="noopener">http://python-jenkins.readthedocs.io/en/latest/examples.html#example-1-get-version-of-jenkins</a></p>
<h4 id="2-2ã€jenkinsapi">2.2ã€jenkinsapi</h4><p>jenkinsapi å®˜æ–¹é“¾æ¥ï¼š<br><a href="https://pypi.org/project/jenkinsapi/#description" target="_blank" rel="noopener">https://pypi.org/project/jenkinsapi/#description</a></p>
<h3 id="3ã€python-jenkinsåº“">3ã€python-jenkinsåº“</h3><h4 id="3-1å®‰è£…">3.1å®‰è£…</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install </span>python-<span class="keyword">jenkins</span></span><br><span class="line"><span class="keyword"># </span>æˆ–è€…</span><br><span class="line">easy_install python-<span class="keyword">jenkins</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2æ¡ˆä¾‹">3.2æ¡ˆä¾‹</h3><h4 id="3-2-1_è·å–ç‰ˆæœ¬å·">3.2.1 è·å–ç‰ˆæœ¬å·</h4><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import jenkinsâ€¨</span><br><span class="line"><span class="keyword">server</span> = jenkins.Jenkins(<span class="string">'http://localhost:8080'</span>, username=<span class="string">'admin'</span>, password=<span class="string">'admin'</span>)â€¨</span><br><span class="line">user = <span class="keyword">server</span>.get_whoami()â€¨</span><br><span class="line">version = <span class="keyword">server</span>.get_version()â€¨</span><br><span class="line">print(<span class="string">'Hello %s from Jenkins %s'</span> % (user[<span class="string">'fullName'</span>], version))</span><br></pre></td></tr></table></figure>
<p>3.2.2 ç®€å•API<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line">import jenkins</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jenkins_Api</span>(<span class="title">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>._url=<span class="string">'http://192.168.72.128:8080'</span></span><br><span class="line">        <span class="keyword">self</span>._username=<span class="string">"admin"</span></span><br><span class="line">        <span class="keyword">self</span>._password=<span class="string">"admin"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_server_instance</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        server=jenkins.Jenkins(<span class="keyword">self</span>._url, username=<span class="keyword">self</span>._username, password=<span class="keyword">self</span>._password)</span><br><span class="line">        user=server.get_whoami()</span><br><span class="line">        <span class="keyword">return</span> server</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_version</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().get_version()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_jobs</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"jobs_count"</span><span class="symbol">:self</span>.get_server_instance().jobs_count(),</span><br><span class="line">             <span class="string">"get_jobs"</span><span class="symbol">:self</span>.get_server_instance().get_jobs()&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_job</span><span class="params">(<span class="keyword">self</span>,job_name)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().create_job(job_name)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_job_confing</span><span class="params">(<span class="keyword">self</span>,job_name)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().get_job_config(job_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy_job</span><span class="params">(<span class="keyword">self</span>,job_name,new_job_name)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().copy_job(job_name,new_job_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_job</span><span class="params">(<span class="keyword">self</span>,job_name,parameters=None,)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().build_job(job_name,parameters=parameters)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_build</span><span class="params">(<span class="keyword">self</span>,job_name,number)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().delete_build(job_name,number)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_job_info</span><span class="params">(<span class="keyword">self</span>,job_name)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().get_job_info(<span class="string">'test'</span>)[<span class="string">'lastCompletedBuild'</span>][<span class="string">'number'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_build_info</span><span class="params">(<span class="keyword">self</span>,job_name,number)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().get_build_info(job_name, number)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_build_console_output</span><span class="params">(<span class="keyword">self</span>, job_name, number)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().get_build_console_output(job_name, number)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_view</span><span class="params">(<span class="keyword">self</span>,view_name)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().create_view(view_name,config_xml=jenkins.EMPTY_VIEW_CONFIG_XML)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_views</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.get_server_instance().get_views()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span>==<span class="string">'__main__'</span><span class="symbol">:</span></span><br><span class="line">    print(Jenkins_Api().get_views())</span><br><span class="line">    <span class="comment"># print(Jenkins_Api().get_build_console_output(job_name='test',number=7))</span></span><br><span class="line">    print(Jenkins_Api().build_job(job_name=<span class="string">'test'</span>,parameters=&#123;<span class="string">"Branch"</span><span class="symbol">:<span class="string">"origin/master"</span></span>&#125;))</span><br></pre></td></tr></table></figure></p>
<h3 id="4ã€jenkinsapiåº“">4ã€jenkinsapiåº“</h3><h4 id="4-1å®‰è£…">4.1å®‰è£…</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install </span>python-<span class="keyword">jenkins</span></span><br><span class="line"><span class="keyword"># </span>æˆ–è€…</span><br><span class="line">easy_install python-<span class="keyword">jenkins</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2æ¡ˆä¾‹">4.2æ¡ˆä¾‹</h3><h4 id="4-2-1è·å–ç‰ˆæœ¬å·">4.2.1è·å–ç‰ˆæœ¬å·</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import jenkinsapi</span><br><span class="line">from jenkinsapi<span class="selector-class">.jenkins</span> import Jenkins</span><br><span class="line">J=Jenkins(<span class="string">'http://192.168.72.128:8080'</span>,username=<span class="string">"admin"</span>,password=<span class="string">"admin"</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(J.version)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-2_è·å–Jobè¯¦ç»†è¾“å‡º">4.2.2 è·å–Jobè¯¦ç»†è¾“å‡º</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Jenkins server</span><br><span class="line"><span class="keyword">from</span> jenkinsapi.jenkins <span class="keyword">import</span> Jenkins</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_server_instance</span><span class="params">()</span>:</span></span><br><span class="line">    jenkins_url = <span class="string">'http://jenkins_host:8080'</span></span><br><span class="line">    server = Jenkins(<span class="string">'http://192.168.72.128:8080'</span>,username=<span class="string">"admin"</span>,password=<span class="string">"admin"</span>)</span><br><span class="line">    <span class="keyword">return</span> server</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_job_details</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Refer Example #1 for definition of function 'get_server_instance'</span></span><br><span class="line">    server = get_server_instance()</span><br><span class="line">    <span class="keyword">for</span> job_name, job_instance <span class="keyword">in</span> server.get_jobs():</span><br><span class="line">        print(<span class="string">"-"</span>*<span class="number">20</span>)</span><br><span class="line">        print(<span class="string">'Job Name:%s'</span> % (job_instance.name))</span><br><span class="line">        print(<span class="string">'Job Description:%s'</span> % (job_instance.get_description()))</span><br><span class="line">        print(<span class="string">'Is Job running:%s'</span> % (job_instance.is_running()))</span><br><span class="line">        print(<span class="string">'Is Job enabled:%s'</span> % (job_instance.is_enabled()))</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3_è·å–æœ€æ–°æ„å»ºè¾“å‡º">4.2.3 è·å–æœ€æ–°æ„å»ºè¾“å‡º</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jenkinsapi</span><br><span class="line"><span class="keyword">from</span> jenkinsapi.jenkins <span class="keyword">import</span> Jenkins</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_server_instance</span><span class="params">()</span>:</span></span><br><span class="line">    jenkins_url = <span class="string">'http://jenkins_host:8080'</span></span><br><span class="line">    server = Jenkins(<span class="string">'http://192.168.72.128:8080'</span>,username=<span class="string">"admin"</span>,password=<span class="string">"admin"</span>)</span><br><span class="line">    <span class="keyword">return</span> server</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_last_console</span><span class="params">()</span>:</span></span><br><span class="line">    server = get_server_instance()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> server.keys():</span><br><span class="line">        print(server[i].get_last_completed_build().get_console())</span><br></pre></td></tr></table></figure>
<h4 id="4-2-4_ç®€å•API">4.2.4 ç®€å•API</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from jenkinsapi.jenkins import Jenkins</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jenkins_Api</span>(<span class="title">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>._url=<span class="string">'http://192.168.72.128:8080'</span></span><br><span class="line">        <span class="keyword">self</span>._username=<span class="string">"admin"</span></span><br><span class="line">        <span class="keyword">self</span>._password=<span class="string">"admin"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_server_instance</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        server = Jenkins(<span class="keyword">self</span>._url, username=<span class="keyword">self</span>._username, password=<span class="keyword">self</span>._password)</span><br><span class="line">        <span class="keyword">return</span> server</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_version</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">self</span>.get_server_instance().version</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_job_last_console</span><span class="params">(<span class="keyword">self</span>,job_name)</span></span><span class="symbol">:</span></span><br><span class="line">        data=&#123;</span><br><span class="line">                <span class="string">'time'</span>: str(<span class="keyword">self</span>.get_server_instance()[job_name].get_last_completed_build().get_timestamp()),</span><br><span class="line">                <span class="string">'status'</span><span class="symbol">:self</span>.get_server_instance()[job_name].get_last_completed_build().get_status(),</span><br><span class="line">                 <span class="string">'res'</span><span class="symbol">:self</span>.get_server_instance()[job_name].get_last_completed_build().get_console()</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">        <span class="comment">#return json.dumps(data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span>==<span class="string">'__main__'</span><span class="symbol">:</span></span><br><span class="line">    print(Jenkins_Api().get_job_last_console(job_name=<span class="string">'test'</span>))</span><br></pre></td></tr></table></figure>

	
	</div>
	
  
</div>
	<a type="button" href="/2019/02/17/Pythonè°ƒç”¨Jenkins-api-æ–‡æ¡£/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2019-02-17 </div>
			<div class="article-title"><a href="/2019/02/17/centos7-docker-ä½¿ç”¨ssç§‘å­¦ä¸Šç½‘/">centos7 docker ä½¿ç”¨ssç§‘å­¦ä¸Šç½‘</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <h3 id="å®‰è£…privoxyå®¢æˆ·ç«¯">å®‰è£…privoxyå®¢æˆ·ç«¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install privoxy</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®privoxy">é…ç½®privoxy</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 docker.service.d]# grep -v "^#\|^$" /etc/privoxy/config|grep forward-socks5t</span><br><span class="line">forward-socks5t / 10.80.80.78:1080 .</span><br></pre></td></tr></table></figure>
<h3 id="Dockerå¼€å¯ssç§‘å­¦ä¸Šç½‘">Dockerå¼€å¯ssç§‘å­¦ä¸Šç½‘</h3><h5 id="åœ¨_/etc/systemd/system/docker-service-dç›®å½•ä¸‹æ–°å¢">åœ¨ /etc/systemd/system/docker.service.dç›®å½•ä¸‹æ–°å¢</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">Environment=HTTP_PROXY=http://127.0.0.1:8118/</span><br><span class="line">Environment=HTTPS_PROXY=http://127.0.0.1:8118/</span><br><span class="line">Environment=NO_PROXY=localhost,10.80.80.251,m1empwb1.mirror.aliyuncs.com,docker.io,registry.cn-hangzhou.aliyuncs.com</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 docker.service.d]# systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">[root@node1 docker.service.d]# systemctl show docker |grep 127.0.0.1</span><br><span class="line">Environment=GOTRACEBACK=crash DOCKER_DNS_OPTIONS=\x20\x20\x20\x20\x20--dns\x20192.168.5.21\x20--dns\x20192.168.5.22\x20--dns\x20223.5.5.5\x20\x20\x20\x20\x20\x20\x20--dns-search\x20default.svc.cluster.local\x20--dns-search\x20svc.cluster.local\x20\x20\x20\x20\x20\x20\x20--dns-opt\x20ndots:2\x20--dns-opt\x20timeout:2\x20--dns-opt\x20attempts:2\x20\x20\x20 DOCKER_OPTS=\x20\x20--data-root=/var/lib/docker\x20--log-opt\x20max-size=50m\x20--log-opt\x20max-file=5\x20--iptables=false HTTP_PROXY=http://127.0.0.1:8118/ HTTPS_PROXY=http://127.0.0.1:8118/ NO_PROXY=localhost,10.80.80.251,m1empwb1.mirror.aliyuncs.com,docker.io,registry.cn-hangzhou.aliyuncs.com</span><br><span class="line"></span><br><span class="line">[root@node1 docker.service.d]# systemctl restart docker</span><br></pre></td></tr></table></figure>
<h5 id="éªŒè¯">éªŒè¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 docker.service.d]# docker pull gcr.io/kubernetes-helm/tiller:v2.2.2</span><br><span class="line">v2.2.2: Pulling from kubernetes-helm/tiller</span><br><span class="line">53ebc9bfbcc0: Pull complete </span><br><span class="line">8065d4c79ab9: Pull complete </span><br><span class="line">Digest: sha256:82677f561f8dd67b6095fe7b9646e6913ee99e1d6fdf86705adbf99a69a7d744</span><br><span class="line">Status: Downloaded newer image for gcr.io/kubernetes-helm/tiller:v2.2.2</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéªŒè¯å¤±è´¥æŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œæ³¨é”€ç™»å½•å³å¯<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 docker.service.d]# docker pull gcr.io/google_containers/cluster-proportional-autoscaler-amd64:1.3.0</span><br><span class="line">Error response from daemon: Get https://gcr.io/v2/google_containers/cluster-proportional-autoscaler-amd64/manifests/1.3.0: unauthorized: Not Authorized.</span><br><span class="line"></span><br><span class="line">[root@node1 docker.service.d]# docker logout  gcr.io</span><br><span class="line">Removing login credentials for gcr.io</span><br></pre></td></tr></table></figure></p>

	
	</div>
	
  
</div>
	<a type="button" href="/2019/02/17/centos7-docker-ä½¿ç”¨ssç§‘å­¦ä¸Šç½‘/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2019-02-17 </div>
			<div class="article-title"><a href="/2019/02/17/åˆ†å¸ƒå¼æ—¶åºæ•°æ®åº“InfluxDB/">åˆ†å¸ƒå¼æ—¶åºæ•°æ®åº“InfluxDB</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <h3 id="ä»€ä¹ˆæ˜¯InfluxDBï¼Ÿ">ä»€ä¹ˆæ˜¯InfluxDBï¼Ÿ</h3><blockquote>
<p>InfluxDB æ˜¯ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ã€‚ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ã€‚å…¶è®¾è®¡ç›®æ ‡æ˜¯å®ç°åˆ†å¸ƒå¼å’Œæ°´å¹³ä¼¸ç¼©æ‰©å±•ã€‚</p>
</blockquote>
<p>å®ƒæœ‰ä¸‰å¤§ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>Time Series ï¼ˆæ—¶é—´åºåˆ—ï¼‰ï¼š</strong> ä½ å¯ä»¥ä½¿ç”¨ä¸æ—¶é—´æœ‰å…³çš„ç›¸å…³å‡½æ•°ï¼ˆå¦‚æœ€å¤§ï¼Œæœ€å°ï¼Œæ±‚å’Œç­‰ï¼‰</li>
<li>â€¨ <strong>Metricsï¼ˆåº¦é‡ï¼‰ï¼š</strong>ä½ å¯ä»¥å®æ—¶å¯¹å¤§é‡æ•°æ®è¿›è¡Œè®¡ç®—â€¨</li>
<li><strong>Eeventsï¼ˆäº‹ä»¶ï¼‰ï¼š</strong>å®ƒæ”¯æŒä»»æ„çš„äº‹ä»¶æ•°æ®</li>
</ul>
<p>å®˜ç½‘ä»‹ç»ï¼š<a href="https://www.influxdata.com/" target="_blank" rel="noopener">https://www.influxdata.com/</a></p>
<h3 id="å¦‚ä½•å®‰è£…InfluxDBï¼Ÿ">å¦‚ä½•å®‰è£…InfluxDBï¼Ÿ</h3><p>ç³»ç»Ÿç¯å¢ƒï¼šCentOS Linux release 7.3.1611 (Core)<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-<span class="number">1.2</span>.<span class="number">4</span>.x86_64.rpm</span><br><span class="line">sudo yum localinstall influxdb-<span class="number">1.2</span>.<span class="number">4</span>.x86_64.rpm</span><br><span class="line">sudo systemctl  start  influxdb</span><br></pre></td></tr></table></figure></p>
<p>å®˜ç½‘ä¸‹è½½è¿æ¥ï¼š<a href="https://portal.influxdata.com/downloads" target="_blank" rel="noopener">https://portal.influxdata.com/downloads</a></p>
<h3 id="ç®€å•ä»‹ç»InfluxDBç”¨æ³•">ç®€å•ä»‹ç»InfluxDBç”¨æ³•</h3><p>é»˜è®¤å¼€å¯WEBè®¿é—®ç•Œé¢åœ°å€ä¸ºIP:8083,é»˜è®¤ç™»å½•è´¦å·å’Œå¯†ç ä¸ºroot/root</p>
<p> <img src="/img/201902/influxBD01.png" style="width: 550x;"></p>
<p>Linuxå­—ç¬¦è¿›å…¥ç›´æ¥è¾“å…¥influx</p>
<h4 id="influxDBåè¯">influxDBåè¯</h4><ul>
<li><strong>databaseï¼š</strong> æ•°æ®åº“ï¼›</li>
<li><strong>measurementï¼š</strong> æ•°æ®åº“ä¸­çš„è¡¨ï¼›</li>
<li><strong>pointsï¼š</strong> è¡¨é‡Œé¢çš„ä¸€è¡Œæ•°æ®ã€‚</li>
</ul>
<h4 id="influxDBä¸­ç‹¬æœ‰çš„ä¸€äº›æ¦‚å¿µ">influxDBä¸­ç‹¬æœ‰çš„ä¸€äº›æ¦‚å¿µ</h4><p>Pointç”±æ—¶é—´æˆ³ï¼ˆtimeï¼‰ã€æ•°æ®ï¼ˆfieldï¼‰å’Œæ ‡ç­¾ï¼ˆtagsï¼‰ç»„æˆã€‚</p>
<ul>
<li><strong>timeï¼š</strong> æ¯æ¡æ•°æ®è®°å½•çš„æ—¶é—´ï¼Œä¹Ÿæ˜¯æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„ä¸»ç´¢å¼•ï¼›</li>
<li><strong>fieldsï¼š</strong> å„è®°å½•çš„å€¼ï¼›</li>
<li><strong>tagsï¼š</strong> å„ç§æœ‰ç´¢å¼•çš„å±æ€§ã€‚</li>
</ul>
<h4 id="æ–°å¢æ•°æ®åº“">æ–°å¢æ•°æ®åº“</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">"db_name"</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span> <span class="comment">#æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br></pre></td></tr></table></figure>
<h4 id="è¿›å…¥æ•°æ®åº“">è¿›å…¥æ•°æ®åº“</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="string">"db_name"</span></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¯¥æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨  </span></span><br><span class="line"><span class="keyword">show</span> measurements</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºè¡¨ï¼Œç›´æ¥åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™æŒ‡å®šè¡¨å">åˆ›å»ºè¡¨ï¼Œç›´æ¥åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™æŒ‡å®šè¡¨å</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; insert <span class="keyword">test</span>-measurements,host=<span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>,monitor_name=<span class="keyword">test</span> count=<span class="number">1</span></span><br><span class="line">&gt; SHOW MEASUREMENTS</span><br><span class="line"><span class="symbol">name:</span> measurements</span><br><span class="line">------------------</span><br><span class="line">name</span><br><span class="line"><span class="keyword">test</span>-measurements</span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤è¡¨">åˆ é™¤è¡¨</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">drop</span> measurement <span class="string">"measurement_name"</span></span><br></pre></td></tr></table></figure>
<h4 id="é€šè¿‡APIæ’å…¥æ•°æ®">é€šè¿‡APIæ’å…¥æ•°æ®</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -<span class="selector-tag">i</span> -XPOST -u username:password <span class="string">"http://192.168.162.113:8086/write?db=test"</span> --data-binary <span class="string">'test-measurements  value=120'</span></span><br></pre></td></tr></table></figure>
<p> <img src="/img/201902/influxBD02.png" style="width: 550x;"></p>
<h6 id="æ³¨æ„æ˜¯å¦å­˜åœ¨testæ•°æ®åº“ï¼Œæ²¡æœ‰åˆ™æ–°å¢">æ³¨æ„æ˜¯å¦å­˜åœ¨testæ•°æ®åº“ï¼Œæ²¡æœ‰åˆ™æ–°å¢</h6><p> <img src="/img/201902/influxBD03.png" style="width: 550x;"></p>
<h4 id="æŸ¥è¯¢è¯­æ³•">æŸ¥è¯¢è¯­æ³•</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="tag">&lt;<span class="name">field_key</span>&gt;</span>[,<span class="tag">&lt;<span class="name">field_key</span>&gt;</span>,<span class="tag">&lt;<span class="name">tag_key</span>&gt;</span>] FROM <span class="tag">&lt;<span class="name">measurement_name</span>&gt;</span>[,<span class="tag">&lt;<span class="name">measurement_name</span>&gt;</span>]</span><br></pre></td></tr></table></figure>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.influxdata.com/influxdb/v1.0/query_language/data_exploration/?spm=5176.100239.blogcont61915.11.R6KaBi" target="_blank" rel="noopener">https://docs.influxdata.com/influxdb/v1.0/query_language/data_exploration/?spm=5176.100239.blogcont61915.11.R6KaBi</a></p>
<h3 id="ç»“åˆGrafana">ç»“åˆGrafana</h3><h4 id="å®˜ç½‘ä»‹ç»ï¼š">å®˜ç½‘ä»‹ç»ï¼š</h4><ul>
<li><a href="https://github.com/torkelo/grafana" target="_blank" rel="noopener">https://github.com/torkelo/grafana</a></li>
<li><a href="http://docs.grafana.org/features/datasources/influxdb/" target="_blank" rel="noopener">http://docs.grafana.org/features/datasources/influxdb/</a></li>
</ul>
<h4 id="å®‰è£…ä¸‹è½½Grafana">å®‰è£…ä¸‹è½½Grafana</h4><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/grafana/grafana/releases" target="_blank" rel="noopener">https://github.com/grafana/grafana/releases</a><br>æˆ–è€…ç›´æ¥ä½¿ç”¨rpmå®‰è£…ï¼š<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://s3-us-west<span class="string">-2</span>.amazonaws.com/grafana-releases/release/grafana<span class="string">-4</span>.4.1<span class="string">-1</span>.x86_64.rpm</span><br><span class="line">yum install initscripts fontconfig</span><br><span class="line">yum localinstall grafana<span class="string">-4</span>.4.1<span class="string">-1</span>.x86_64.rpm\</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="keyword">start</span> grafana-<span class="keyword">server</span></span><br><span class="line">systemctl <span class="keyword">status</span> grafana-<span class="keyword">server</span></span><br><span class="line">netstat -ntlp|grep <span class="number">3000</span></span><br><span class="line">lsof -i:<span class="number">3000</span></span><br></pre></td></tr></table></figure>
<h4 id="ç®€å•é…ç½®Grafana">ç®€å•é…ç½®Grafana</h4><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://docs.grafana.org/features/datasources/influxdb/" target="_blank" rel="noopener">http://docs.grafana.org/features/datasources/influxdb/</a></p>
<p>å®‰è£…åç™»é™†åœ°å€ä¸ºï¼š<a href="http://IP:3000/login,é»˜è®¤è´¦å·å’Œå¯†ç éƒ½æ˜¯admin" target="_blank" rel="noopener">http://IP:3000/login,é»˜è®¤è´¦å·å’Œå¯†ç éƒ½æ˜¯admin</a><br> <img src="/img/201902/influxBD04.png" style="width: 550x;"><br> <img src="/img/201902/influxBD05.png" style="width: 550x;"><br> <img src="/img/201902/influxBD06.png" style="width: 550x;"></p>

	
	</div>
	
  
</div>
	<a type="button" href="/2019/02/17/åˆ†å¸ƒå¼æ—¶åºæ•°æ®åº“InfluxDB/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2018-07-29 </div>
			<div class="article-title"><a href="/2018/07/29/ä¼ä¸šå¸¸ç”¨å‡ ç§éƒ¨ç½²æ–¹å¼-è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²ã€é‡‘ä¸é›€éƒ¨ç½²/">ä¼ä¸šå¸¸ç”¨å‡ ç§éƒ¨ç½²æ–¹å¼(è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²ã€é‡‘ä¸é›€éƒ¨ç½²)</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <blockquote>
<p>éƒ¨ç½²æ˜¯å°†æœåŠ¡çš„æŸä¸ªç‰ˆæœ¬æŠ•å…¥ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹ã€‚éƒ¨ç½²çš„æ€»ä½“ç›®æ ‡æ˜¯ï¼šå¯¹ç³»ç»Ÿç”¨æˆ·äº§ç”Ÿæœ€å°å½±å“çš„æƒ…å†µä¸‹ï¼ŒæŠŠæœåŠ¡çš„å‡çº§ç‰ˆæœ¬æŠ•æ”¾åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p>
</blockquote>
<h3 id="æœåŠ¡å˜æ›´çš„ä¸»è¦åŸå› ï¼š">æœåŠ¡å˜æ›´çš„ä¸»è¦åŸå› ï¼š</h3><ul>
<li>1ã€ä¿®å¤é”™è¯¯</li>
<li>2ã€æé«˜æœåŠ¡çš„è´¨é‡</li>
<li>3ã€å¢åŠ æ–°çš„åŠŸèƒ½</li>
</ul>
<h3 id="æœåŠ¡å˜æ›´éœ€è¦æ³¨æ„å“ªäº›(æˆ–è€…è¯´å¦‚ä½•äº§ç”Ÿæœ€å°å½±å“)ï¼Ÿ">æœåŠ¡å˜æ›´éœ€è¦æ³¨æ„å“ªäº›(æˆ–è€…è¯´å¦‚ä½•äº§ç”Ÿæœ€å°å½±å“)ï¼Ÿ</h3><p>SRE ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼Œå¤§æ¦‚ 70% çš„ç”Ÿäº§äº‹æ•…ç”±æŸç§éƒ¨ç½²çš„å˜æ›´è€Œè§¦å‘ã€‚å˜æ›´ç®¡ç†çš„æœ€ä½³å®è·µå¯ä½¿ç”¨è‡ªåŠ¨åŒ–æ¥å®Œæˆä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>1ã€éƒ¨ç½²å°½å¯èƒ½åœ¨ç”¨æˆ·å°‘çš„æ—¶å€™ã€‚</li>
<li>2ã€æ¯æ¬¡éƒ¨ç½²å‰å¤‡ä»½åŸå§‹æ•°æ®ã€‚</li>
<li>3ã€é‡‡ç”¨æ¸è¿›å¼å‘å¸ƒæœºåˆ¶ã€‚</li>
<li>4ã€è¿…é€Ÿè€Œå‡†ç¡®åœ°æ£€æµ‹åˆ°é—®é¢˜çš„å‘ç”Ÿã€‚</li>
<li>5ã€å½“å‡ºç°é—®é¢˜æ—¶ï¼Œå®‰å…¨è¿…é€Ÿåœ°å›é€€æ”¹åŠ¨ã€‚</li>
</ul>
<h3 id="å¸¸ç”¨éƒ¨ç½²æ–¹å¼å­˜åœ¨ä»¥ä¸‹å‡ ç§:">å¸¸ç”¨éƒ¨ç½²æ–¹å¼å­˜åœ¨ä»¥ä¸‹å‡ ç§:</h3><ul>
<li>è“ç»¿éƒ¨ç½²</li>
<li>æ»šåŠ¨éƒ¨ç½²</li>
<li>ç°åº¦éƒ¨ç½²/é‡‘ä¸é›€éƒ¨ç½²</li>
</ul>
<h4 id="è“ç»¿éƒ¨ç½²">è“ç»¿éƒ¨ç½²</h4><h5 id="å®šä¹‰ï¼š">å®šä¹‰ï¼š</h5><p>è“ç»¿éƒ¨ç½²(éƒ¨åˆ†ç§°å¤§ç¿»è½¬æˆ–çº¢/é»‘éƒ¨ç½²)ï¼Œé¦–å…ˆå‡†å¤‡Nå°æä¾›ç‰ˆæœ¬AæœåŠ¡çš„æœºå™¨ï¼ŒåŒæ—¶å‡†å¤‡Nå°æä¾›ç‰ˆæœ¬Bçš„æœºå™¨ã€‚ä¸€æ—¦ç‰ˆæœ¬Bçš„Nå°æœºå™¨é…ç½®å¥½å¹¶å‡†å¤‡å¥½æœåŠ¡è¯·æ±‚ï¼Œé€šè¿‡åˆ‡æ¢è·¯ç”±åˆ°ç‰ˆæœ¬B,ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€ç»¿è‰²è¡¨ç¤ºå½“å‰çš„ç”Ÿäº§åº”ç”¨ç¨‹åºV1<br> <img src="/img/201807/greendeployment.png" style="width: 550x;"></p>
<p>2ã€ç°åœ¨ï¼Œå½“æ‚¨å‡†å¤‡å¯¹app2è¿›è¡Œæ›´æ”¹å¹¶å°†å…¶å‡çº§åˆ°v2æ—¶ï¼Œæ‚¨å°†åœ¨â€è“è‰²ç¯å¢ƒâ€ä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚åœ¨è¯¥ç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥éƒ¨ç½²æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼Œè¿è¡Œå†’çƒŸæµ‹è¯•ä»¥åŠä»»ä½•å…¶ä»–æµ‹è¯•ï¼ˆåŒ…æ‹¬æ“ä½œç³»ç»Ÿï¼Œç¼“å­˜ï¼ŒCPUç­‰ï¼‰ã€‚å½“ç»“æœçœ‹èµ·æ¥ä¸é”™æ—¶ï¼Œæ‚¨å¯ä»¥å°†è´Ÿè½½å‡è¡¡å™¨/åå‘ä»£ç†/è·¯ç”±å™¨æ›´æ”¹ä¸ºæŒ‡å‘è“è‰²ç¯å¢ƒï¼š</p>
<p> <img src="/img/201807/bluedeployment.png" style="width: 550x;"></p>
<h5 id="æ–¹æ³•ï¼š">æ–¹æ³•ï¼š</h5><ul>
<li>å¯ä»¥é€šè¿‡åˆ‡æ¢åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰</li>
<li>æ›´æ”¹è´Ÿè½½å‡è¡¡å™¨è·¯ç”±åˆ‡æ¢</li>
</ul>
<h5 id="ä¼˜ç‚¹ï¼š">ä¼˜ç‚¹ï¼š</h5><ul>
<li>æ›´æ–°è¿‡ç¨‹æ— éœ€åœæœºï¼Œé£é™©è¾ƒå°‘</li>
<li>å›æ»šæ–¹ä¾¿ï¼Œåªéœ€è¦æ›´æ”¹è·¯ç”±æˆ–è€…åˆ‡æ¢DNSæœåŠ¡å™¨ï¼Œæ•ˆç‡è¾ƒé«˜</li>
</ul>
<h5 id="ç¼ºç‚¹ï¼š">ç¼ºç‚¹ï¼š</h5><ul>
<li>éœ€è¦éƒ¨ç½²ä¸¤å¥—æœºå™¨ï¼Œè´¹ç”¨å¼€é”€å¤§</li>
<li>åœ¨ééš”ç¦»çš„æœºå™¨ï¼ˆDockerã€VMï¼‰ä¸Šæ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´è“ç»¿ç¯å¢ƒè¢«æ‘§æ¯é£é™©</li>
<li>è´Ÿè½½å‡è¡¡å™¨/åå‘ä»£ç†/è·¯ç”±/DNSå¤„ç†ä¸å½“ï¼Œå°†å¯¼è‡´æµé‡æ²¡æœ‰åˆ‡æ¢è¿‡æ¥æƒ…å†µå‡ºç°</li>
</ul>
<h4 id="æ»šåŠ¨å‘å¸ƒï¼š">æ»šåŠ¨å‘å¸ƒï¼š</h4><h5 id="å®šä¹‰ï¼š-1">å®šä¹‰ï¼š</h5><p>ç°ç”Ÿäº§Nå°æœºå™¨éƒ½ä¸ºç‰ˆæœ¬Açš„æœºå™¨ï¼Œéƒ¨ç½²å–å‡ºä¸€ä¸ªæˆ–è€…å¤šä¸ªæœåŠ¡å™¨åœæ­¢æœåŠ¡ï¼Œæ‰§è¡Œæ›´æ–°ç‰ˆæœ¬Bï¼Œæ›´æ–°åé‡æ–°å°†å…¶æŠ•å…¥ä½¿ç”¨ï¼Œç»§ç»­ä¸æ–­æ›´æ–°å…¶ä»–æœºå™¨ï¼Œç›´åˆ°é›†ç¾¤ä¸­æ‰€æœ‰çš„å®ä¾‹éƒ½æ›´æ–°æˆç‰ˆæœ¬Bã€‚</p>
<h5 id="æµç¨‹ï¼š">æµç¨‹ï¼š</h5><ul>
<li>1ã€è´Ÿè½½å‡è¡¡æˆ–è€…è·¯ç”±ç§»é™¤ä¸€å°æˆ–è€…å¤šå°å®ä¾‹(æ­£å¸¸ç›‘æ§ä¹Ÿéœ€è¦ç§»é™¤)</li>
<li>2ã€ç§»é™¤åçš„å®ä¾‹å¼€å§‹æ›´æ–°</li>
<li>3ã€ä¸Šçº¿æµ‹è¯•åæ— å¼‚å¸¸å¼€å§‹æ¥å…¥è´Ÿè½½å‡è¡¡å™¨æˆ–è€…è·¯ç”±</li>
<li>4ã€æ–°å¢å®ä¾‹ç›‘æ§</li>
<li>5ã€ç»§ç»­ä¸Šçº¿åä¸€æ‰¹å®ä¾‹ï¼Œç›´åˆ°é›†ç¾¤ä¸­æ‰€æœ‰çš„å®ä¾‹éƒ½æ›´æ–°</li>
</ul>
<h5 id="ä¼˜ç‚¹ï¼š-1">ä¼˜ç‚¹ï¼š</h5><ul>
<li>æ›´æ–°è¿‡ç¨‹ä½“éªŒå½±å“å°‘ï¼Œé£é™©è¾ƒå°‘</li>
<li>è´¹ç”¨å¯¹æ¯”è“ç»¿èŠ±è´¹å¼€é”€è¾ƒå°‘ï¼Œæ— éœ€é¢å¤–æ–°å¢æœºå™¨</li>
</ul>
<h5 id="ç¼ºç‚¹ï¼š-1">ç¼ºç‚¹ï¼š</h5><ul>
<li>ä¸Šçº¿/å›æ»šå®Œæˆæ—¶é—´ç›¸å¯¹è¾ƒæ…¢</li>
<li>éœ€è¦ç›‘æ§å’Œè´Ÿè½½å‡è¡¡å™¨çš„ç§»é™¤å’Œæ¥å…¥èƒ½åŠ›</li>
</ul>
<h4 id="ç°åº¦å‘å¸ƒ">ç°åº¦å‘å¸ƒ</h4><h5 id="å®šä¹‰">å®šä¹‰</h5><p>ç°åº¦å‘å¸ƒï¼ˆåˆåé‡‘ä¸é›€å‘å¸ƒï¼‰æ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´ï¼Œèƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚ç°åº¦å‘å¸ƒå¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦ã€‚ï¼ˆç±»ä¼¼åœ°ä¸‹é‡‡ç…¤ä½¿ç”¨çš„é‡‘ä¸é›€æ–¹æ³•ï¼Œå½“é‡‘ä¸é›€é‡åˆ°æœ‰æ¯’æ°”ä½“æ—¶å€™ï¼Œäº§ç”Ÿç—›è‹¦ä¿¡å·ï¼‰A/B testingå’Œé‡‘ä¸é›€çš„å·®åˆ«åœ¨äºA/B æµ‹è¯•å¯¹äºç‰¹å®šä¸šåŠ¡çš„å…³é”®ç»©æ•ˆæŒ‡æ ‡æ¥è¯´ï¼Œç¡®å®šé‚£ä¸ªç‰ˆæœ¬æ‰§è¡Œå¾—æ›´å¥½ã€‚</p>
<h5 id="æ–¹æ³•">æ–¹æ³•</h5><ul>
<li>é¦–å…ˆéƒ¨ç½²å°‘é‡æœåŠ¡å™¨å¯†åˆ‡</li>
<li>è§‚å¯Ÿæ˜¯å¦å› ä¸ºç‰ˆæœ¬äº§ç”Ÿé¢„æœŸç»“æœ</li>
<li>å½“ç»“æœæ»¡æ„æ—¶å€™å†å…¨é‡éƒ¨ç½²</li>
</ul>
<p> <img src="/img/201807/beta.png" style="width: 550x;"></p>
<p> <img src="/img/201807/AB-test.png" style="width: 550x;"></p>
<p> ä¼˜ç¼ºç‚¹å¯ä»¥å‚è€ƒä¸Šé¢</p>
<h4 id="å…³äºCAPå®šç†">å…³äºCAPå®šç†</h4><ul>
<li>ä¸€è‡´æ€§ï¼ˆConsistenceï¼‰ ï¼ˆç­‰åŒäºæ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬ï¼‰</li>
<li>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½èƒ½è·å–åˆ°éé”™çš„å“åº”â€”â€”ä½†æ˜¯ä¸ä¿è¯è·å–çš„æ•°æ®ä¸ºæœ€æ–°æ•°æ®ï¼‰</li>
<li>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼ˆä»¥å®é™…æ•ˆæœè€Œè¨€ï¼Œåˆ†åŒºç›¸å½“äºå¯¹é€šä¿¡çš„æ—¶é™è¦æ±‚ã€‚ç³»ç»Ÿå¦‚æœä¸èƒ½åœ¨æ—¶é™å†…è¾¾æˆæ•°æ®ä¸€è‡´æ€§ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†åˆ†åŒºçš„æƒ…å†µï¼Œå¿…é¡»å°±å½“å‰æ“ä½œåœ¨Cå’ŒAä¹‹é—´åšå‡ºé€‰æ‹©[3]ã€‚ï¼‰</li>
</ul>
<p>æˆ‘ä»¬è¿™é‡Œåªè®¨è®ºä¸€è‡´æ€§é—®é¢˜ï¼Œå…¶ä»–ä½ ä»¬å¯ä»¥è‡ªè¡Œæ€è€ƒä¸‹ï¼š</p>
<ul>
<li>å»ºè®®æ— çŠ¶æ€(sessionç­‰ä¿¡æ¯å­˜æ”¾åœ¨ç¼“å­˜æ•°æ®åº“)</li>
<li>å¦‚æœæ–°ç‰ˆæœ¬çš„æ“ä½œæ¶‰åŠåˆ°æ•°æ®åº“æ›´æ”¹ï¼Œå»ºè®®ä¿æŒåªæ–°å¢ä¸åˆ å‡å­—æ®µæ“ä½œ</li>
</ul>
<p>è¦æ˜¯å­˜åœ¨å¤šç‰ˆæœ¬åŒæ—¶å­˜åœ¨ï¼Œæ³¨æ„è€ƒè™‘ä»¥ä¸‹ï¼š</p>
<ul>
<li>1ã€åŠŸèƒ½å¼€å…³</li>
<li>2ã€å‰åç‰ˆæœ¬å…¼å®¹</li>
</ul>
<p>å‚è€ƒèµ„æ–™åŒ…æ‹¬ä»¥ä¸‹ï¼š</p>
<ul>
<li><a href="http://blog.christianposta.com/deploy/blue-green-deployments-a-b-testing-and-canary-releases/" target="_blank" rel="noopener">http://blog.christianposta.com/deploy/blue-green-deployments-a-b-testing-and-canary-releases/</a></li>
<li><a href="https://docs.cloudfoundry.org/devguide/deploy-apps/blue-green.html" target="_blank" rel="noopener">https://docs.cloudfoundry.org/devguide/deploy-apps/blue-green.html</a></li>
</ul>

	
	</div>
	
  
</div>
	<a type="button" href="/2018/07/29/ä¼ä¸šå¸¸ç”¨å‡ ç§éƒ¨ç½²æ–¹å¼-è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²ã€é‡‘ä¸é›€éƒ¨ç½²/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2018-07-29 </div>
			<div class="article-title"><a href="/2018/07/29/Pyecharts-ç”Ÿæˆå›¾è¡¨-é™„Djangoæ”¯æŒ/">Pyecharts ç”Ÿæˆå›¾è¡¨(é™„Djangoæ”¯æŒ)</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <blockquote>
<p>pyecharts æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆ Echarts å›¾è¡¨çš„ç±»åº“ã€‚Echarts æ˜¯ç™¾åº¦å¼€æºçš„ä¸€ä¸ªæ•°æ®å¯è§†åŒ– JS åº“ã€‚ç”¨ Echarts ç”Ÿæˆçš„å›¾å¯è§†åŒ–æ•ˆæœéå¸¸æ£’ï¼Œpyecharts æ˜¯ä¸ºäº†ä¸ Python è¿›è¡Œå¯¹æ¥ï¼Œæ–¹ä¾¿åœ¨ Python ä¸­ç›´æ¥ä½¿ç”¨æ•°æ®ç”Ÿæˆå›¾ã€‚</p>
</blockquote>
<h3 id="å®‰è£…">å®‰è£…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyecharts</span><br></pre></td></tr></table></figure>
<h3 id="ç®€å•å®ä¾‹">ç®€å•å®ä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyecharts <span class="keyword">import</span> Bar</span><br><span class="line">bar = Bar(<span class="string">"æˆ‘çš„ç¬¬ä¸€ä¸ªå›¾è¡¨"</span>, <span class="string">"è¿™é‡Œæ˜¯å‰¯æ ‡é¢˜"</span>)</span><br><span class="line">bar.add(<span class="string">"æœè£…"</span>, [<span class="string">"è¡¬è¡«"</span>, <span class="string">"ç¾Šæ¯›è¡«"</span>, <span class="string">"é›ªçººè¡«"</span>, <span class="string">"è£¤å­"</span>, <span class="string">"é«˜è·Ÿé‹"</span>, <span class="string">"è¢œå­"</span>], [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">75</span>, <span class="number">90</span>])</span><br><span class="line"><span class="comment"># bar.print_echarts_options() # è¯¥è¡Œåªä¸ºäº†æ‰“å°é…ç½®é¡¹ï¼Œæ–¹ä¾¿è°ƒè¯•æ—¶ä½¿ç”¨</span></span><br><span class="line">bar.render()    <span class="comment"># ç”Ÿæˆæœ¬åœ° HTML æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>
<p>é»˜è®¤å½“å‰ç›®å½•ä¸‹ç”Ÿæˆrender.htmlï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€å¦‚ä¸‹ï¼š<br> <img src="/img/201807/Pyecharts01.png" style="width: 550x;"></p>
<h5 id="å›¾å½¢ç»˜åˆ¶è¿‡ç¨‹">å›¾å½¢ç»˜åˆ¶è¿‡ç¨‹</h5><p>åŸºæœ¬ä¸Šæ‰€æœ‰çš„å›¾è¡¨ç±»å‹éƒ½æ˜¯è¿™æ ·ç»˜åˆ¶çš„ï¼š</p>
<ul>
<li>chart_name = Type() åˆå§‹åŒ–å…·ä½“ç±»å‹å›¾è¡¨ã€‚</li>
<li>add() æ·»åŠ æ•°æ®åŠé…ç½®é¡¹ã€‚</li>
<li>render() ç”Ÿæˆæœ¬åœ°æ–‡ä»¶ï¼ˆhtml/svg/jpeg/png/pdf/gifï¼‰ã€‚</li>
</ul>
<p>add() æ•°æ®ä¸€èˆ¬ä¸ºä¸¤ä¸ªåˆ—è¡¨ï¼ˆé•¿åº¦ä¸€è‡´ï¼‰ã€‚å¦‚æœä½ çš„æ•°æ®æ˜¯å­—å…¸æˆ–è€…æ˜¯å¸¦å…ƒç»„çš„å­—å…¸ã€‚å¯åˆ©ç”¨ cast() æ–¹æ³•è½¬æ¢ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line">cast(seq)</span><br><span class="line">è½¬æ¢æ•°æ®åºåˆ—ï¼Œå°†å¸¦å­—å…¸å’Œå…ƒç»„ç±»å‹çš„åºåˆ—è½¬æ¢ä¸º k_lst,v_lst ä¸¤ä¸ªåˆ—è¡¨</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>å…ƒç»„åˆ—è¡¨</strong><br>[(A1, B1), (A2, B2), (A3, B3), (A4, B4)] â€“&gt; k_lst[ A[i1, i2â€¦] ], v_lst[ B[i1, i2â€¦] ]</li>
<li><strong>å­—å…¸åˆ—è¡¨</strong><br>[{A1: B1}, {A2: B2}, {A3: B3}, {A4: B4}] â€“&gt; k_lst[ A[i1, i2â€¦] ], v_lst[ B[i1, i2â€¦] ]</li>
<li><strong>å­—å…¸</strong><br>{A1: B1, A2: B2, A3: B3, A4: B4} â€“ &gt; k_lst[ A[i1, i2â€¦] ], v_lst[ B[i1, i2â€¦] ]</li>
</ul>
<h3 id="ç»“åˆDjangoæ˜¾ç¤ºä»¥ä¸Šå›¾å½¢">ç»“åˆDjangoæ˜¾ç¤ºä»¥ä¸Šå›¾å½¢</h3><h4 id="åŸºç¡€ç¯å¢ƒ">åŸºç¡€ç¯å¢ƒ</h4><ul>
<li><strong>Django_version:</strong> 2.1a1</li>
<li><strong>Python_verison:</strong> 3.6.5</li>
</ul>
<h4 id="url-py">url.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span>  TemplateView  <span class="comment">#é€šç”¨è§†å›¾</span></span><br><span class="line"><span class="keyword">from</span> apps.ops <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r'^test/$'</span>, views.test),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="app-ops-views-py">app.ops.views.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"><span class="keyword">from</span> pyecharts <span class="keyword">import</span> Bar</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line">REMOTE_HOST = <span class="string">"https://pyecharts.github.io/assets/js"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    template = loader.get_template(<span class="string">'test/pyecharts.html'</span>)</span><br><span class="line">    b = bar()</span><br><span class="line">    context = dict(</span><br><span class="line">        myechart=b.render_embed(),</span><br><span class="line">        host=REMOTE_HOST,</span><br><span class="line">        script_list=b.get_js_dependencies()</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context, request))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">    bar = Bar(<span class="string">"æˆ‘çš„ç¬¬ä¸€ä¸ªå›¾è¡¨"</span>, <span class="string">"è¿™é‡Œæ˜¯å‰¯æ ‡é¢˜"</span>)</span><br><span class="line">    bar.add(<span class="string">"æœè£…"</span>, [<span class="string">"è¡¬è¡«"</span>, <span class="string">"ç¾Šæ¯›è¡«"</span>, <span class="string">"é›ªçººè¡«"</span>, <span class="string">"è£¤å­"</span>, <span class="string">"é«˜è·Ÿé‹"</span>, <span class="string">"è¢œå­"</span>], [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">75</span>, <span class="number">90</span>])</span><br><span class="line">    <span class="comment"># bar.print_echarts_options() # è¯¥è¡Œåªä¸ºäº†æ‰“å°é…ç½®é¡¹ï¼Œæ–¹ä¾¿è°ƒè¯•æ—¶ä½¿ç”¨</span></span><br><span class="line">    <span class="comment"># bar.render()  # ç”Ÿæˆæœ¬åœ° HTML æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">return</span> bar</span><br></pre></td></tr></table></figure>
<ul>
<li><p>script_list æ˜¯ Page() ç±»æ¸²æŸ“ç½‘é¡µæ‰€éœ€è¦ä¾èµ–çš„ echarts js åº“ï¼Œä¾èµ–çš„åº“çš„æ•°é‡å–å†³äºæ‰€è¦æ¸²æŸ“çš„å›¾å½¢ç§ç±»ã€‚</p>
</li>
<li><p>host æ˜¯ echarts js åº“çš„åœ°å€ï¼Œé»˜è®¤æä¾›çš„åœ°å€ä¸º <a href="https://pyecharts.github.io/assets/js" target="_blank" rel="noopener">https://pyecharts.github.io/assets/js</a> å½“ç„¶ï¼Œå¦‚æœä½ æ„¿æ„ä½ ä¹Ÿå¯ä»¥æ”¹å˜è¿™ä¸ªåœ°å€ï¼Œå…ˆå…‹éš† <a href="https://github.com/pyecharts/assets" target="_blank" rel="noopener">https://github.com/pyecharts/assets</a> ç„¶åå°† js æ–‡ä»¶å¤¹æŒ‚è½½åœ¨ä½ è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå³å¯ã€‚</p>
</li>
</ul>
<h4 id="templates/test/pyecharts-html">templates/test/pyecharts.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- myfirstvis/templates/pyecharts.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Proudly presented by PycCharts<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% for jsfile_name in script_list %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; host &#125;&#125;/&#123;&#123; jsfile_name &#125;&#125;.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  &#123;&#123; myechart|safe &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨djangoè®¿é—®/test/å³å¯</p>

	
	</div>
	
  
</div>
	<a type="button" href="/2018/07/29/Pyecharts-ç”Ÿæˆå›¾è¡¨-é™„Djangoæ”¯æŒ/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2018-07-29 </div>
			<div class="article-title"><a href="/2018/07/29/Pythonè°ƒç”¨Zabbix-Apiè·å–æ•°æ®/">Pythonè°ƒç”¨Zabbix Apiè·å–æ•°æ®</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <h3 id="è¯·æ±‚çš„æ–¹æ³•å‚æ•°">è¯·æ±‚çš„æ–¹æ³•å‚æ•°</h3><p>å®˜æ–¹åŸæ–‡ï¼š</p>
<ul>
<li><strong>jsonrpc</strong> - the version of the JSON-RPC protocol used by the API; the  Zabbix API implements JSON-RPC version 2.0;</li>
<li><strong>method</strong> - the API method being called;</li>
<li><strong>params</strong> - parameters that will be passed to the API method;</li>
<li><strong>id</strong> - an arbitrary identifier of the request;</li>
<li><strong>auth</strong> - a user authentication token; since we donâ€™t have one yet, itâ€™s set to null.</li>
</ul>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th style="text-align:center">å€¼ç±»å‹</th>
<th style="text-align:left">è¯´æ˜</th>
<th>æ˜¯å¦å¿…é¡»</th>
</tr>
</thead>
<tbody>
<tr>
<td>jsonrpc</td>
<td style="text-align:center">str</td>
<td style="text-align:left">æ¥å£ç‰ˆæœ¬</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>method</td>
<td style="text-align:center">str</td>
<td style="text-align:left">è¯·æ±‚æ–¹æ³•</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>params</td>
<td style="text-align:center">json</td>
<td style="text-align:left">è¯·æ±‚æ–¹æ³•å‚æ•°</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>user</td>
<td style="text-align:center">str</td>
<td style="text-align:left">zabbixè´¦å·</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>password</td>
<td style="text-align:center">str</td>
<td style="text-align:left">zabbixå¯†ç </td>
<td>æ˜¯</td>
</tr>
<tr>
<td>auth</td>
<td style="text-align:center">str</td>
<td style="text-align:left">è®¤è¯çš„key</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>id</td>
<td style="text-align:center">int</td>
<td style="text-align:left">è®¤è¯id</td>
<td>æ˜¯</td>
</tr>
</tbody>
</table>
<p>è¯·æ±‚äº‹ä¾‹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST http://company.com/zabbix/api_jsonrpc.php HTTP/1.1</span><br><span class="line">Content-Type: application/json-rpc</span><br><span class="line"></span><br><span class="line">&#123;"jsonrpc":"2.0","method":"apiinfo.version","id":1,"auth":null,"params":&#123;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="pythonè·å–token">pythonè·å–token</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys, argparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Zabbix_Api</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.url = <span class="string">'http://IP/zabbix/api_jsonrpc.php'</span></span><br><span class="line">        self.header = &#123;<span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>&#125;</span><br><span class="line">        self.id = <span class="number">1</span></span><br><span class="line">        self.user=<span class="string">"zabbixç™»å½•è´¦å·"</span></span><br><span class="line">        self.password=<span class="string">"zabbixç™»å½•å¯†ç "</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">json_obj</span><span class="params">(self,method,auth=True,params=&#123;&#125;)</span>:</span></span><br><span class="line">        obj = &#123;<span class="string">'jsonrpc'</span>: <span class="string">'2.0'</span>,</span><br><span class="line">               <span class="string">'method'</span>: method,</span><br><span class="line">               <span class="string">'params'</span>: params,</span><br><span class="line">               <span class="string">'auth'</span>: auth,</span><br><span class="line">               <span class="string">'id'</span>: self.id&#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> auth:</span><br><span class="line">            <span class="keyword">del</span> obj[<span class="string">"auth"</span>]</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">user_login</span><span class="params">(self)</span>:</span></span><br><span class="line">        data=self.json_obj(method=<span class="string">"user.login"</span>,auth=<span class="keyword">False</span>, params=&#123;<span class="string">"user"</span>: self.user, <span class="string">"password"</span>: self.password&#125;)</span><br><span class="line">        <span class="keyword">return</span> json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)[<span class="string">"result"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(Zabbix_Api().user_login())</span><br></pre></td></tr></table></figure>
<h3 id="è·å–ç‰ˆæœ¬ä¿¡æ¯">è·å–ç‰ˆæœ¬ä¿¡æ¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_version</span><span class="params">(self)</span>:</span></span><br><span class="line">    data=self.json_obj(method=<span class="string">"apiinfo.version"</span>,</span><br><span class="line">        params=&#123;</span><br><span class="line">            <span class="string">"output"</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        auth=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span> json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)</span><br></pre></td></tr></table></figure>
<h3 id="host-getæ–¹æ³•è·å–æ‰€æœ‰çš„ä¸»æœºID">host.getæ–¹æ³•è·å–æ‰€æœ‰çš„ä¸»æœºID</h3><table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th style="text-align:center">å€¼ç±»å‹</th>
<th style="text-align:left">è¯´æ˜</th>
<th>æ˜¯å¦å¿…é¡»</th>
</tr>
</thead>
<tbody>
<tr>
<td>jsonrpc</td>
<td style="text-align:center">str</td>
<td style="text-align:left">æ¥å£ç‰ˆæœ¬</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>method</td>
<td style="text-align:center">str</td>
<td style="text-align:left">è¯·æ±‚æ–¹æ³•</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>params</td>
<td style="text-align:center">json</td>
<td style="text-align:left">è¯·æ±‚æ–¹æ³•å‚æ•°</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>output</td>
<td style="text-align:center">array</td>
<td style="text-align:left">è¾“å‡ºæ ¼å¼</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>groupids</td>
<td style="text-align:center">str/array</td>
<td style="text-align:left">ä¸»æœºç»„id</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>auth</td>
<td style="text-align:center">str</td>
<td style="text-align:left">è®¤è¯çš„key</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>id</td>
<td style="text-align:center">int</td>
<td style="text-align:left">è®¤è¯id</td>
<td>æ˜¯</td>
</tr>
</tbody>
</table>
<p>è¯·æ±‚äº‹ä¾‹(å‚è€ƒä¸Šé¢ç±»)ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_host</span><span class="params">(self)</span>:</span></span><br><span class="line">    data=self.json_obj(method=<span class="string">"host.get"</span>,</span><br><span class="line">        params=&#123;</span><br><span class="line">            <span class="string">"output"</span>: [<span class="string">"hostid"</span>, <span class="string">"name"</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        auth=self.user_login())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)</span><br></pre></td></tr></table></figure></p>
<h3 id="itemsid-getæ–¹æ³•è·å–å•ä¸ªä¸»æœºä¸‹æ‰€æœ‰çš„ç›‘æ§é¡¹ID">itemsid.getæ–¹æ³•è·å–å•ä¸ªä¸»æœºä¸‹æ‰€æœ‰çš„ç›‘æ§é¡¹ID</h3><table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th style="text-align:center">å€¼ç±»å‹</th>
<th style="text-align:left">è¯´æ˜</th>
<th>æ˜¯å¦å¿…é¡»</th>
</tr>
</thead>
<tbody>
<tr>
<td>jsonrpc</td>
<td style="text-align:center">str</td>
<td style="text-align:left">æ¥å£ç‰ˆæœ¬</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>method</td>
<td style="text-align:center">str</td>
<td style="text-align:left">è¯·æ±‚æ–¹æ³•</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>params</td>
<td style="text-align:center">json</td>
<td style="text-align:left">è¯·æ±‚æ–¹æ³•å‚æ•°</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>output</td>
<td style="text-align:center">array</td>
<td style="text-align:left">è¾“å‡ºæ ¼å¼</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>groupids</td>
<td style="text-align:center">str/array</td>
<td style="text-align:left">ä¸»æœºç»„id</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>auth</td>
<td style="text-align:center">str</td>
<td style="text-align:left">è®¤è¯çš„key</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>id</td>
<td style="text-align:center">int</td>
<td style="text-align:left">è®¤è¯id</td>
<td>æ˜¯</td>
</tr>
</tbody>
</table>
<p>è¯·æ±‚äº‹ä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mem_total</span><span class="params">(self,hostid)</span>:</span></span><br><span class="line">    data=self.json_obj(method=<span class="string">"item.get"</span>,</span><br><span class="line">        params=&#123;</span><br><span class="line">            <span class="string">"output"</span>: <span class="string">"extend"</span>,</span><br><span class="line">            <span class="string">"hostids"</span>: hostid,</span><br><span class="line">            <span class="string">"search"</span>: &#123;</span><br><span class="line">                <span class="string">"key_"</span>: <span class="string">"vm.memory.size[total]"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        auth=self.user_login())</span><br><span class="line">    <span class="keyword">return</span> int(json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)[<span class="string">"result"</span>][<span class="number">0</span>][<span class="string">"lastvalue"</span>])/<span class="number">1024</span>/<span class="number">1024</span>/<span class="number">1024</span></span><br></pre></td></tr></table></figure></p>
<h3 id="ä»¥ä¸Šå®Œæ•´äº‹ä¾‹">ä»¥ä¸Šå®Œæ•´äº‹ä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys, argparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Zabbix_Api</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.url = <span class="string">'http://192.168.31.249/zabbix/api_jsonrpc.php'</span></span><br><span class="line">        self.header = &#123;<span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>&#125;</span><br><span class="line">        self.id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">json_obj</span><span class="params">(self,method,auth=True,params=&#123;&#125;)</span>:</span></span><br><span class="line">        obj = &#123;<span class="string">'jsonrpc'</span>: <span class="string">'2.0'</span>,</span><br><span class="line">               <span class="string">'method'</span>: method,</span><br><span class="line">               <span class="string">'params'</span>: params,</span><br><span class="line">               <span class="string">'auth'</span>: auth,</span><br><span class="line">               <span class="string">'id'</span>: self.id&#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> auth:</span><br><span class="line">            <span class="keyword">del</span> obj[<span class="string">"auth"</span>]</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">user_login</span><span class="params">(self)</span>:</span></span><br><span class="line">        data=self.json_obj(method=<span class="string">"user.login"</span>,auth=<span class="keyword">False</span>, params=&#123;<span class="string">"user"</span>: <span class="string">"yunwei"</span>, <span class="string">"password"</span>: <span class="string">"yunwei"</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)[<span class="string">"result"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_host</span><span class="params">(self)</span>:</span></span><br><span class="line">        data=self.json_obj(method=<span class="string">"host.get"</span>,</span><br><span class="line">            params=&#123;</span><br><span class="line">                <span class="string">"output"</span>: [<span class="string">"hostid"</span>, <span class="string">"name"</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            auth=self.user_login())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_mem_total</span><span class="params">(self,hostid)</span>:</span></span><br><span class="line">        data=self.json_obj(method=<span class="string">"item.get"</span>,</span><br><span class="line">            params=&#123;</span><br><span class="line">                <span class="string">"output"</span>: <span class="string">"extend"</span>,</span><br><span class="line">                <span class="string">"hostids"</span>: hostid,</span><br><span class="line">                <span class="string">"search"</span>: &#123;</span><br><span class="line">                    <span class="string">"key_"</span>: <span class="string">"vm.memory.size[total]"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            auth=self.user_login())</span><br><span class="line">        <span class="keyword">return</span> int(json.loads(requests.post(url=self.url, headers=self.header, data=json.dumps(data)).text)[<span class="string">"result"</span>][<span class="number">0</span>][<span class="string">"lastvalue"</span>])/<span class="number">1024</span>/<span class="number">1024</span>/<span class="number">1024</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># for k in Zabbix_Api().get_host()["result"]:</span></span><br><span class="line">    <span class="comment">#     print(k["hostid"],k["name"],str(round(Zabbix_Api().get_mem(k["hostid"]),2))+"G")</span></span><br><span class="line">    print(Zabbix_Api().get_mem_total(<span class="number">10084</span>))</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šåªæ˜¯ç®€å•ä¸¾ä¾‹ï¼Œå…·ä½“å®è·µå¯å‚è€ƒå®˜ç½‘æ–‡æ¡£(è¦æ°¸è¿œç›¸ä¿¡å®˜æ–¹æ–‡æ¡£æ˜¯æœ€å¥½çš„æ–‡æ¡£)ï¼š<a href="https://www.zabbix.com/documentation/3.0/manual/api" target="_blank" rel="noopener">https://www.zabbix.com/documentation/3.0/manual/api</a></p>

	
	</div>
	
  
</div>
	<a type="button" href="/2018/07/29/Pythonè°ƒç”¨Zabbix-Apiè·å–æ•°æ®/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2018-07-29 </div>
			<div class="article-title"><a href="/2018/07/29/Djangoä¸­çš„ç¼“å­˜é…ç½®/">Djangoä¸­çš„ç¼“å­˜é…ç½®</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <blockquote>
<p>æŒ‰ç…§ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹ä¸­æ‰€è¯´ï¼Œç½‘ç«™æ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€å®šå¾‹ï¼šä¼˜å…ˆè€ƒè™‘ç¼“å­˜ä¼˜åŒ–æ€§èƒ½.ä»Šå¤©ç®€å•æ¢è®¨ä¸‹djangoçš„ç¼“å­˜å®ç°ã€‚</p>
</blockquote>
<p>ç¼“å­˜ä¸€äº›ä¸œè¥¿æ˜¯ä¸ºäº†ä¿å­˜é‚£äº›éœ€è¦å¾ˆå¤šè®¡ç®—èµ„æºçš„ç»“æœï¼Œè¿™æ ·çš„è¯å°±ä¸å¿…åœ¨ä¸‹æ¬¡é‡å¤æ¶ˆè€—è®¡ç®—èµ„æºã€‚ ä¸‹é¢æ˜¯ä¸€äº›ä¼ªä»£ç ï¼Œç”¨æ¥è§£é‡Šç¼“å­˜æ€æ ·åœ¨åŠ¨æ€ç”Ÿæˆçš„ç½‘é¡µä¸­å·¥ä½œçš„ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iven a URL, <span class="keyword">try</span> finding that page <span class="keyword">in</span> the cache</span><br><span class="line"><span class="keyword">if</span> the page <span class="keyword">is</span> <span class="keyword">in</span> the cache:</span><br><span class="line">    <span class="keyword">return</span> the cached page</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    generate the page</span><br><span class="line">    save the generated page <span class="keyword">in</span> the cache (<span class="keyword">for</span> next time)</span><br><span class="line">    <span class="keyword">return</span> the generated page</span><br></pre></td></tr></table></figure></p>
<h4 id="Djangoä¸­çš„ç¼“å­˜ç±»å‹">Djangoä¸­çš„ç¼“å­˜ç±»å‹</h4><ul>
<li>1ã€å†…å­˜ç¼“å­˜</li>
<li>2ã€æ•°æ®åº“ç¼“å­˜</li>
<li>3ã€æ–‡ä»¶ç¼“å­˜</li>
</ul>
<h4 id="Djangoå¦‚ä½•è®¾ç½®ç¼“å­˜">Djangoå¦‚ä½•è®¾ç½®ç¼“å­˜</h4><p>ç¼“å­˜ç³»ç»Ÿéœ€è¦ä¸€äº›è®¾ç½®æ‰èƒ½ä½¿ç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¿…é¡»å‘Šè¯‰ä»–ä½ è¦æŠŠæ•°æ®ç¼“å­˜åœ¨å“ªé‡Œ- æ˜¯æ•°æ®åº“ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç›´æ¥åœ¨å†…å­˜ä¸­ã€‚ è¿™ä¸ªå†³å®šå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä¼šå½±å“ä½ çš„ç¼“å­˜æ€§èƒ½ï¼Œç¼“å­˜é…ç½®æ˜¯é€šè¿‡setting æ–‡ä»¶çš„CACHES é…ç½®æ¥å®ç°çš„ã€‚ </p>
<h5 id="ç¼“å­˜å‚æ•°">ç¼“å­˜å‚æ•°</h5><ul>
<li><p><strong>TIMEOUT:</strong> ç”¨äºç¼“å­˜çš„é»˜è®¤è¶…æ—¶ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚æ­¤å‚æ•°é»˜è®¤ä¸º300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰ã€‚</p>
</li>
<li><p><strong>OPTIONS:</strong> åº”ä¼ é€’ç»™ç¼“å­˜åç«¯çš„ä»»ä½•é€‰é¡¹ã€‚(åŒ…æ‹¬ä»¥ä¸‹)</p>
</li>
<li>MAX_ENTRIESï¼šåˆ é™¤æ—§å€¼ä¹‹å‰ç¼“å­˜ä¸­å…è®¸çš„æœ€å¤§æ¡ç›®æ•°ã€‚æ­¤å‚æ•°é»˜è®¤ä¸º300ã€‚</li>
<li>CULL_FREQUENCYï¼šMAX_ENTRIESè¾¾åˆ°æ—¶å‰”é™¤çš„æ¡ç›®éƒ¨åˆ†ã€‚å®é™…æ¯”ç‡æ˜¯ ï¼Œè®¾ç½®ä¸ºåœ¨è¾¾åˆ°æ—¶å‰”é™¤ä¸€åŠæ•°ç›®ã€‚</li>
<li>EY_PREFIXï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†è‡ªåŠ¨åŒ…å«ï¼ˆé»˜è®¤æƒ…å†µä¸‹é¢„å…ˆæ·»åŠ ï¼‰åˆ°DjangoæœåŠ¡å™¨ä½¿ç”¨çš„æ‰€æœ‰ç¼“å­˜é”®ã€‚</li>
<li>VERSIONï¼šDjangoæœåŠ¡å™¨ç”Ÿæˆçš„ç¼“å­˜é”®çš„é»˜è®¤ç‰ˆæœ¬å·ã€‚</li>
<li>KEY_FUNCTION åŒ…å«å‡½æ•°çš„è™šçº¿è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œç”¨äºå®šä¹‰å¦‚ä½•å°†å‰ç¼€ï¼Œç‰ˆæœ¬å’Œå¯†é’¥ç»„åˆä¸ºæœ€ç»ˆç¼“å­˜é”®ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###ä¾‹å­</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'/var/tmp/django_cache'</span>,</span><br><span class="line">        <span class="string">'TIMEOUT'</span>: <span class="number">60</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'MAX_ENTRIES'</span>: <span class="number">1000</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="å†…å­˜ç¼“å­˜(Memcached)">å†…å­˜ç¼“å­˜(Memcached)</h5><p>Memcachedæ˜¯Djangoæœ¬èº«æ”¯æŒçš„æœ€å¿«ï¼Œæœ€æœ‰æ•ˆçš„ç¼“å­˜ç±»å‹ï¼Œå®ƒ æ˜¯ä¸€ä¸ªå®Œå…¨åŸºäºå†…å­˜çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œæœ€åˆæ˜¯ä¸ºäº†å¤„ç†LiveJournal.comçš„é«˜è´Ÿè½½è€Œå¼€å‘çš„ï¼Œåæ¥ç”±Danga Interactiveå¼€æºã€‚Facebookå’ŒWikipediaç­‰ç½‘ç«™ä½¿ç”¨å®ƒæ¥å‡å°‘æ•°æ®åº“è®¿é—®å¹¶æ˜¾ç€æé«˜ç½‘ç«™æ€§èƒ½ã€‚</p>
<p>Memcachedä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œå¹¶åˆ†é…äº†æŒ‡å®šæ•°é‡çš„RAMã€‚å®ƒæ‰€åšçš„å°±æ˜¯æä¾›ä¸€ä¸ªå¿«é€Ÿæ¥å£ï¼Œç”¨äºåœ¨ç¼“å­˜ä¸­æ·»åŠ ï¼Œæ£€ç´¢å’Œåˆ é™¤æ•°æ®ã€‚æ‰€æœ‰æ•°æ®éƒ½ç›´æ¥å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ä¸ä¼šäº§ç”Ÿæ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨çš„å¼€é”€ã€‚</p>
<p>å®‰è£…Memcachedæœ¬èº«åï¼Œæ‚¨éœ€è¦å®‰è£…Memcachedç»‘å®šã€‚æœ‰å‡ ä¸ªPython Memcachedç»‘å®šå¯ç”¨; æœ€å¸¸è§çš„ä¸¤ä¸ªæ˜¯python-memcachedå’Œpylibmcã€‚</p>
<p>åœ¨Djangoä¸­ä½¿ç”¨Memcachedï¼š</p>
<ul>
<li>è®¾ç½®BACKENDä¸º django.core.cache.backends.memcached.MemcachedCacheæˆ– django.core.cache.backends.memcached.PyLibMCCacheï¼ˆå–å†³äºæ‚¨é€‰æ‹©çš„memcachedç»‘å®šï¼‰</li>
<li>è®¾ç½®LOCATIONä¸ºip:portå€¼ï¼Œå…¶ä¸­ipæ˜¯Memcachedå®ˆæŠ¤ç¨‹åºçš„IPåœ°å€ï¼Œportæ˜¯è¿è¡ŒMemcachedçš„ç«¯å£ï¼Œæˆ–è€…æ˜¯unix:pathå€¼ï¼Œå…¶ä¸­ pathæ˜¯Memcached Unixå¥—æ¥å­—æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
</ul>
<p><strong>Memcachedä½¿ç”¨python-memcachedç»‘å®šåœ¨localhostï¼ˆ127.0.0.1ï¼‰ç«¯å£11211ä¸Šè¿è¡Œ:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'127.0.0.1:11211'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Memcachedå¯é€šè¿‡/tmp/memcached.sockä½¿ç”¨python-memcachedç»‘å®šçš„æœ¬åœ°Unixå¥—æ¥å­—æ–‡ä»¶:</strong></p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    '<span class="attribute">default'</span>: &#123;</span><br><span class="line">        'BACKEND': 'django<span class="variable">.core</span><span class="variable">.cache</span><span class="variable">.backends</span><span class="variable">.memcached</span><span class="variable">.MemcachedCache</span>',</span><br><span class="line">        'LOCATION': 'unix:/tmp/memcached<span class="variable">.sock</span>',</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>ç”¨pylibmcç»‘å®šæ—¶ï¼Œè¯·ä¸è¦åŒ…å«unix:/å‰ç¼€:</strong><br><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    '<span class="attribute">default'</span>: &#123;</span><br><span class="line">        'BACKEND': 'django<span class="variable">.core</span><span class="variable">.cache</span><span class="variable">.backends</span><span class="variable">.memcached</span><span class="variable">.PyLibMCCache</span>',</span><br><span class="line">        'LOCATION': '/tmp/memcached<span class="variable">.sock</span>',</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="æ•°æ®åº“ç¼“å­˜">æ•°æ®åº“ç¼“å­˜</h5><p>Djangoå¯ä»¥å°†å…¶ç¼“å­˜çš„æ•°æ®å­˜å‚¨åœ¨æ‚¨çš„æ•°æ®åº“ä¸­ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå¿«é€Ÿï¼Œç´¢å¼•è‰¯å¥½çš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œè¿™ç§æ–¹æ³•æ•ˆæœæœ€å¥½ã€‚</p>
<p>è¦å°†æ•°æ®åº“è¡¨ç”¨ä½œç¼“å­˜åç«¯ï¼š</p>
<ul>
<li>è®¾ç½®BACKENDä¸º django.core.cache.backends.db.DatabaseCache</li>
<li>è®¾ç½®LOCATIONä¸ºtablenameï¼Œæ•°æ®åº“è¡¨çš„åç§°ï¼Œæ³¨æ„è¿™ä¸ªè¡¨åº”è¯¥æ˜¯è¿˜æ²¡æœ‰æ–°å¢çš„ã€‚</li>
</ul>
<p><strong>ç¼“å­˜è¡¨çš„åç§°ä¸ºmy_cache_tableï¼š</strong><br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CACHES</span> = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.db.DatabaseCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'my_cache_table'</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>åˆ›å»ºç¼“å­˜è¡¨,åœ¨ä½¿ç”¨æ•°æ®åº“ç¼“å­˜ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºç¼“å­˜è¡¨ï¼š</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage<span class="selector-class">.py</span> createcachetable</span><br></pre></td></tr></table></figure>
<h6 id="å¤šä¸ªæ•°æ®åº“">å¤šä¸ªæ•°æ®åº“</h6><p>å¦‚æœå¯¹å¤šä¸ªæ•°æ®åº“ä½¿ç”¨æ•°æ®åº“ç¼“å­˜ï¼Œåˆ™è¿˜éœ€è¦ä¸ºæ•°æ®åº“ç¼“å­˜è¡¨è®¾ç½®è·¯ç”±æŒ‡ä»¤ã€‚å‡ºäºè·¯ç”±çš„ç›®çš„ï¼Œæ•°æ®åº“ç¼“å­˜è¡¨CacheEntryåœ¨åä¸ºçš„åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºä¸ºåä¸ºçš„æ¨¡å‹ django_cacheã€‚æ­¤æ¨¡å‹ä¸ä¼šå‡ºç°åœ¨æ¨¡å‹ç¼“å­˜ä¸­ï¼Œä½†æ¨¡å‹è¯¦ç»†ä¿¡æ¯å¯ç”¨äºè·¯ç”±ç›®çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹è·¯ç”±å™¨å°†æŒ‡å‘æ‰€æœ‰é«˜é€Ÿç¼“å­˜è¯»å–æ“ä½œcache_replicaï¼Œå¹¶å°†æ‰€æœ‰å†™å…¥æ“ä½œæŒ‡å‘ cache_primaryã€‚ç¼“å­˜è¡¨å°†ä»…åŒæ­¥åˆ° cache_primaryï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheRouter</span>:</span></span><br><span class="line">    <span class="string">"""A router to control all database cache operations"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_for_read</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        <span class="string">"All cache read operations go to the replica"</span></span><br><span class="line">        <span class="keyword">if</span> model._meta.app_label == <span class="string">'django_cache'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'cache_replica'</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_for_write</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        <span class="string">"All cache write operations go to primary"</span></span><br><span class="line">        <span class="keyword">if</span> model._meta.app_label == <span class="string">'django_cache'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'cache_primary'</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_migrate</span><span class="params">(self, db, app_label, model_name=None, **hints)</span>:</span></span><br><span class="line">        <span class="string">"Only install the cache model on primary"</span></span><br><span class="line">        <span class="keyword">if</span> app_label == <span class="string">'django_cache'</span>:</span><br><span class="line">            <span class="keyword">return</span> db == <span class="string">'cache_primary'</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæœªæŒ‡å®šæ•°æ®åº“ç¼“å­˜æ¨¡å‹çš„è·¯ç”±æ–¹å‘ï¼Œåˆ™ç¼“å­˜åç«¯å°†ä½¿ç”¨è¯¥defaultæ•°æ®åº“ã€‚å½“ç„¶ï¼Œå¦‚æœä¸ä½¿ç”¨æ•°æ®åº“ç¼“å­˜åç«¯ï¼Œåˆ™æ— éœ€æ‹…å¿ƒä¸ºæ•°æ®åº“ç¼“å­˜æ¨¡å‹æä¾›è·¯ç”±æŒ‡ä»¤ã€‚</p>
<h4 id="æ–‡ä»¶ç³»ç»Ÿç¼“å­˜">æ–‡ä»¶ç³»ç»Ÿç¼“å­˜</h4><p>åŸºäºæ–‡ä»¶çš„åç«¯å°†æ¯ä¸ªç¼“å­˜å€¼åºåˆ—åŒ–å¹¶å­˜å‚¨ä¸ºå•ç‹¬çš„æ–‡ä»¶ã€‚è¦ä½¿ç”¨æ­¤åç«¯è®¾ç½®BACKENDæ¥ â€œdjango.core.cache.backends.filebased.FileBasedCacheâ€å’Œ LOCATIONåˆ°åˆé€‚çš„ç›®å½•ã€‚ä¾‹å¦‚ï¼Œè¦å­˜å‚¨ç¼“å­˜æ•°æ®/var/tmp/django_cacheï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è®¾ç½®ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CACHES</span> = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'/var/tmp/django_cache'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Windowsï¼Œè¯·å°†é©±åŠ¨å™¨å·æ”¾åœ¨è·¯å¾„çš„å¼€å¤´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CACHES</span> = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'c:/foo/bar'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ç¼“å­˜æ•´ä¸ªç«™ç‚¹">ç¼“å­˜æ•´ä¸ªç«™ç‚¹</h4><p>å¯ä»¥åœ¨settingsé…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MIDDLEWARE</span> = [</span><br><span class="line">    <span class="string">'django.middleware.cache.UpdateCacheMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.cache.FetchFromCacheMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h4 id="viewsè§†å›¾ç¼“å­˜">viewsè§†å›¾ç¼“å­˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"></span><br><span class="line"><span class="meta">@cache_page(60 * 15)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šcache_pageï¼šç¼“å­˜æ—¶é—´ä»¥ç§’ä¸ºå•ä½</p>
<h4 id="è®¿é—®ç¼“å­˜">è®¿é—®ç¼“å­˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> caches</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cache1 = caches[<span class="string">'myalias'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cache2 = caches[<span class="string">'myalias'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cache1 <span class="keyword">is</span> cache2</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<h4 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h4><p>è¯­æ³•ï¼š </p>
<ul>
<li><p>æ–°å¢ç¼“å­˜ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">set(key,</span> <span class="string">value,</span> <span class="string">timeout)</span></span><br><span class="line"><span class="string">get(key)</span> <span class="meta">---</span> <span class="string">å½“å­˜åœ¨keyä¸ä¼šå†æ–°å¢</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è·å–ç¼“å­˜ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">get</span><span class="params">(key)</span></span>---è·å–å•ä¸ªå€¼</span><br><span class="line"><span class="function"><span class="title">get_many</span><span class="params">([<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>])</span></span>---è·å–å¤šä¸ªå€¼</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤ç¼“å­˜</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache.<span class="keyword">delete</span>(<span class="string">'a'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¸…ç©ºç¼“å­˜</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache.<span class="built_in">clear</span>()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¿˜å¯ä»¥åˆ†åˆ«ä½¿ç”¨incr()æˆ–decr()æ–¹æ³•å¢åŠ æˆ–å‡å°‘å·²å­˜åœ¨çš„å¯†é’¥ ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç°æœ‰ç¼“å­˜å€¼å°†é€’å¢æˆ–é€’å‡1.å¯ä»¥é€šè¿‡ä¸ºé€’å¢/é€’å‡è°ƒç”¨æä¾›å‚æ•°æ¥æŒ‡å®šå…¶ä»–é€’å¢/é€’å‡å€¼ã€‚å¦‚æœæ‚¨å°è¯•é€’å¢æˆ–é€’å‡ä¸å­˜åœ¨çš„ç¼“å­˜é”®ï¼Œå°†å¼•å‘ValueErrorï¼š<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; cache.set(<span class="string">'num'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; cache.incr(<span class="string">'num'</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; cache.incr(<span class="string">'num'</span>, <span class="number">10</span>)</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; cache.decr(<span class="string">'num'</span>)</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; cache.decr(<span class="string">'num'</span>, <span class="number">5</span>)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure></p>
<p>è¦æ˜¯è¿˜æœ‰ç–‘é—®ï¼Œå…·ä½“å¯å‚è€ƒï¼š<a href="https://docs.djangoproject.com/zh-hans/2.0/topics/cache/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/2.0/topics/cache/</a></p>

	
	</div>
	
  
</div>
	<a type="button" href="/2018/07/29/Djangoä¸­çš„ç¼“å­˜é…ç½®/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2018-06-16 </div>
			<div class="article-title"><a href="/2018/06/16/Celery-åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—/">Celery - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
  
	<div class="col-md-12">
	  
	
	  <p>Celery æ˜¯ä¸€ä¸ªç®€å•ã€çµæ´»ä¸”å¯é çš„ï¼Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æä¾›ç»´æŠ¤è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„å¿…éœ€å·¥å…·ã€‚</p>
<p>å®ƒæ˜¯ä¸€ä¸ªä¸“æ³¨äºå®æ—¶å¤„ç†çš„ä»»åŠ¡é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒä»»åŠ¡è°ƒåº¦ã€‚</p>
<p>Celery æœ‰å¹¿æ³›ã€å¤šæ ·çš„ç”¨æˆ·ä¸è´¡çŒ®è€…ç¤¾åŒºï¼Œä½ å¯ä»¥é€šè¿‡ IRC æˆ–æ˜¯ é‚®ä»¶åˆ—è¡¨ åŠ å…¥æˆ‘ä»¬ã€‚</p>
<p>Celery æ˜¯å¼€æºçš„ï¼Œä½¿ç”¨ BSD è®¸å¯è¯ æˆæƒã€‚<br>ä¸­æ–‡å®˜ç½‘æ–‡æ¡£åœ°å€ï¼š<a href="http://docs.jinkan.org/docs/celery/" target="_blank" rel="noopener">http://docs.jinkan.org/docs/celery/</a></p>
<h3 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h3><p>åˆ›å»ºtask.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line">app =Celery(<span class="string">'tasks'</span>,broker=<span class="string">'redis://127.0.0.1:6379/0'</span>,backend=<span class="string">'redis://127.0.0.1:6379/0'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure></p>
<p>å¯åŠ¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python]<span class="comment"># celery -A task worker --loglevel=info</span></span><br><span class="line">/usr/lib/python2<span class="number">.7</span>/site-packages/celery/platforms.py:<span class="number">796</span>: RuntimeWarning: Yo<span class="string">u're running the worker with superuser privileges: this is</span></span><br><span class="line"><span class="string">absolutely not recommended!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Please specify a different user using the -u option.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">User information: uid=0 euid=0 gid=0 egid=0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  uid=uid, euid=euid, gid=gid, egid=egid,</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> -------------- celery@localhost.localdomain v4.1.1 (latentcall)</span></span><br><span class="line"><span class="string">---- **** ----- </span></span><br><span class="line"><span class="string">--- * ***  * -- Linux-3.10.0-693.el7.x86_64-x86_64-with-centos-7.4.1708-Core 2018-06-06 05:25:17</span></span><br><span class="line"><span class="string">-- * - **** --- </span></span><br><span class="line"><span class="string">- ** ---------- [config]</span></span><br><span class="line"><span class="string">- ** ---------- .&gt; app:         tasks:0x7f5c3038c150</span></span><br><span class="line"><span class="string">- ** ---------- .&gt; transport:   redis://127.0.0.1:6379/0</span></span><br><span class="line"><span class="string">- ** ---------- .&gt; results:     redis://127.0.0.1:6379/0</span></span><br><span class="line"><span class="string">- *** --- * --- .&gt; concurrency: 1 (prefork)</span></span><br><span class="line"><span class="string">-- ******* ---- .&gt; task events: OFF (enable -E to monitor tasks in this worker)</span></span><br><span class="line"><span class="string">--- ***** ----- </span></span><br><span class="line"><span class="string"> -------------- [queues]</span></span><br><span class="line"><span class="string">                .&gt; celery           exchange=celery(direct) key=celery</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[tasks]</span></span><br><span class="line"><span class="string">  . task.add</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2018-06-06 05:25:17,206: INFO/MainProcess] Connected to redis://127.0.0.1:6379/0</span></span><br><span class="line"><span class="string">[2018-06-06 05:25:17,218: INFO/MainProcess] mingle: searching for neighbors</span></span><br><span class="line"><span class="string">[2018-06-06 05:25:18,241: INFO/MainProcess] mingle: all alone</span></span><br><span class="line"><span class="string">[2018-06-06 05:25:18,281: INFO/MainProcess] celery@localhost.localdomain ready.</span></span><br><span class="line"><span class="string">[2018-06-06 05:26:01,848: INFO/MainProcess] Received task: task.add[69c90eef-309c-45e7-a888-1357129aae6d]</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<blockquote>
<p>æ³¨æ„å®‰è£…redisæ¨¡å—ï¼špip install redis</p>
</blockquote>
</blockquote>
<h3 id="æ‰§è¡Œè°ƒåº¦">æ‰§è¡Œè°ƒåº¦</h3><p>å¯¼å…¥æ¨¡å—å¹¶æ‰§è¡Œè°ƒåº¦<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> task <span class="keyword">import</span> add  <span class="comment">#æ³¨æ„æ¨¡å—è·¯å¾„</span></span><br><span class="line">In [<span class="number">2</span>]: add.delay(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">2</span>]: &lt;AsyncResult: <span class="number">4e4</span>ab6aa<span class="number">-266e-4178</span>-b668<span class="number">-39</span>ada6382113&gt;</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹Celeryç»ˆç«¯è¾“å‡º<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2018</span><span class="number">-06</span><span class="number">-06</span> <span class="number">05</span>:<span class="number">32</span>:<span class="number">20</span>,<span class="number">583</span>: INFO/ForkPoolWorker<span class="number">-1</span>] Task task.add[<span class="number">4e4</span>ab6aa<span class="number">-266e-4178</span>-b668<span class="number">-39</span>ada6382113] succeeded <span class="keyword">in</span> <span class="number">0.00385068000105</span>s: <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹ç»“æœ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">3</span>]: result = add.delay(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: print(result.get())</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹æ¨¡å—çš„å±æ€§åˆ—è¡¨ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">5</span>]: dir(result)</span><br><span class="line"></span><br><span class="line">Out[<span class="number">5</span>]: </span><br><span class="line">[<span class="string">'TimeoutError'</span>,</span><br><span class="line"> <span class="string">'__class__'</span>,</span><br><span class="line"> <span class="string">'__copy__'</span>,</span><br><span class="line"> <span class="string">'__delattr__'</span>,</span><br><span class="line"> <span class="string">'__dict__'</span>,</span><br><span class="line"> <span class="string">'__doc__'</span>,</span><br><span class="line"> <span class="string">'__eq__'</span>,</span><br><span class="line"> <span class="string">'__format__'</span>,</span><br><span class="line"> <span class="string">'__getattribute__'</span>,</span><br><span class="line"> <span class="string">'__hash__'</span>,</span><br><span class="line"> <span class="string">'__init__'</span>,</span><br><span class="line"> <span class="string">'__module__'</span>,</span><br><span class="line"> <span class="string">'__ne__'</span>,</span><br><span class="line"> <span class="string">'__new__'</span>,</span><br><span class="line"> <span class="string">u'__reduce__'</span>,</span><br><span class="line"> <span class="string">'__reduce_args__'</span>,</span><br><span class="line"> <span class="string">'__reduce_ex__'</span>,</span><br><span class="line"> <span class="string">'__repr__'</span>,</span><br><span class="line"> <span class="string">'__setattr__'</span>,</span><br><span class="line"> <span class="string">'__sizeof__'</span>,</span><br><span class="line"> <span class="string">'__str__'</span>,</span><br><span class="line"> <span class="string">'__subclasshook__'</span>,</span><br><span class="line"> <span class="string">'__unicode__'</span>,</span><br><span class="line"> <span class="string">'__unicode_repr__'</span>,</span><br><span class="line"> <span class="string">'__weakref__'</span>,</span><br><span class="line"> <span class="string">'_cache'</span>,</span><br><span class="line"> <span class="string">'_get_task_meta'</span>,</span><br><span class="line"> <span class="string">'_iter_meta'</span>,</span><br><span class="line"> <span class="string">'_maybe_reraise_parent_error'</span>,</span><br><span class="line"> <span class="string">'_maybe_set_cache'</span>,</span><br><span class="line"> <span class="string">'_on_fulfilled'</span>,</span><br><span class="line"> <span class="string">'_parents'</span>,</span><br><span class="line"> <span class="string">'_set_cache'</span>,</span><br><span class="line"> <span class="string">'_to_remote_traceback'</span>,</span><br><span class="line"> <span class="string">'app'</span>,</span><br><span class="line"> <span class="string">'as_tuple'</span>,</span><br><span class="line"> <span class="string">'backend'</span>,</span><br><span class="line"> <span class="string">'build_graph'</span>,</span><br><span class="line"> <span class="string">'children'</span>,</span><br><span class="line"> <span class="string">'collect'</span>,</span><br><span class="line"> <span class="string">'failed'</span>,</span><br><span class="line"> <span class="string">'forget'</span>,</span><br><span class="line"> <span class="string">'get'</span>,</span><br><span class="line"> <span class="string">'get_leaf'</span>,</span><br><span class="line"> <span class="string">'graph'</span>,</span><br><span class="line"> <span class="string">'id'</span>,</span><br><span class="line"> <span class="string">'info'</span>,</span><br><span class="line"> <span class="string">'iterdeps'</span>,</span><br><span class="line"> <span class="string">'maybe_reraise'</span>,</span><br><span class="line"> <span class="string">'maybe_throw'</span>,</span><br><span class="line"> <span class="string">'on_ready'</span>,</span><br><span class="line"> <span class="string">'parent'</span>,</span><br><span class="line"> <span class="string">'ready'</span>,</span><br><span class="line"> <span class="string">'result'</span>,</span><br><span class="line"> <span class="string">'revoke'</span>,</span><br><span class="line"> <span class="string">'state'</span>,</span><br><span class="line"> <span class="string">'status'</span>,</span><br><span class="line"> <span class="string">'successful'</span>,</span><br><span class="line"> <span class="string">'supports_native_join'</span>,</span><br><span class="line"> <span class="string">'task_id'</span>,</span><br><span class="line"> <span class="string">'then'</span>,</span><br><span class="line"> <span class="string">'throw'</span>,</span><br><span class="line"> <span class="string">'traceback'</span>,</span><br><span class="line"> <span class="string">'wait'</span>]</span><br></pre></td></tr></table></figure></p>
<p>è·å–id<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">6</span>]: print(result.id)</span><br><span class="line"><span class="number">30</span>f7fce2<span class="number">-2687</span><span class="number">-448</span>c<span class="number">-816</span>f<span class="number">-11334</span>efc6442</span><br></pre></td></tr></table></figure></p>
<p>ç™»å½•reidsæŸ¥çœ‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost python]<span class="comment"># redis-cli</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; KEYS *</span><br><span class="line"><span class="number">1</span>) <span class="string">"_kombu.binding.celery.pidbox"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"celery-task-meta-69c90eef-309c-45e7-a888-1357129aae6d"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"_kombu.binding.celery"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"_kombu.binding.celeryev"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"celery-task-meta-4e4ab6aa-266e-4178-b668-39ada6382113"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get celery-task-meta<span class="number">-4e4</span>ab6aa<span class="number">-266e-4178</span>-b668<span class="number">-39</span>ada6382113</span><br><span class="line"><span class="string">"&#123;\"status\": \"SUCCESS\", \"traceback\": null, \"result\": 5, \"task_id\": \"4e4ab6aa-266e-4178-b668-39ada6382113\", \"children\": []&#125;"</span></span><br></pre></td></tr></table></figure></p>

	
	</div>
	
  
</div>
	<a type="button" href="/2018/06/16/Celery-åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
        

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/2/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div class="widget tag">
    <h3 class="title">å½’æ¡£</h3>
    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">2019å¹´02æœˆ</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">2018å¹´07æœˆ</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">2018å¹´06æœˆ</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">2018å¹´05æœˆ</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">2018å¹´03æœˆ</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">2018å¹´02æœˆ</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">2018å¹´01æœˆ</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">2017å¹´11æœˆ</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">2017å¹´09æœˆ</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">2017å¹´08æœˆ</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">2017å¹´07æœˆ</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">2017å¹´03æœˆ</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">2017å¹´02æœˆ</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">2016å¹´01æœˆ</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">2015å¹´12æœˆ</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">2015å¹´11æœˆ</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">2015å¹´10æœˆ</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">2015å¹´09æœˆ</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">2015å¹´08æœˆ</a><span class="archive-list-count">5</span></li></ul>
  </div>

		
			
		
			

		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2019/02/18/Dockerå¦‚ä½•æ¨é€é•œåƒåˆ°Harborï¼Ÿ/"><i class="fa fa-file-o"></i>Dockerå¦‚ä½•æ¨é€é•œåƒåˆ°Harborï¼Ÿ</a>
      </li>
    
      <li>
        <a href="/2019/02/18/å¦‚ä½•æ­å»ºé«˜å¯ç”¨Docker-Harborä»“åº“/"><i class="fa fa-file-o"></i>å¦‚ä½•æ­å»ºé«˜å¯ç”¨Docker Harborä»“åº“</a>
      </li>
    
      <li>
        <a href="/2019/02/17/Pythonè°ƒç”¨Jenkins-api-æ–‡æ¡£/"><i class="fa fa-file-o"></i>Pythonè°ƒç”¨Jenkins api æ–‡æ¡£</a>
      </li>
    
      <li>
        <a href="/2019/02/17/centos7-docker-ä½¿ç”¨ssç§‘å­¦ä¸Šç½‘/"><i class="fa fa-file-o"></i>centos7 docker ä½¿ç”¨ssç§‘å­¦ä¸Šç½‘</a>
      </li>
    
      <li>
        <a href="/2019/02/17/åˆ†å¸ƒå¼æ—¶åºæ•°æ®åº“InfluxDB/"><i class="fa fa-file-o"></i>åˆ†å¸ƒå¼æ—¶åºæ•°æ®åº“InfluxDB</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="http://linuxops.cc" title="Macroåšå®¢" target="_blank" ]);">Macroåšå®¢</a></li>
	
		<li><i class="fa fa-github"></i><a href="http://www.uinion.com/" title="uinionå°ç«™" target="_blank" ]);">uinionå°ç«™</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2019 æ—æ–‡æ°
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  
  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'ZP2ZSuHgipSZfRyU8uTR','2.0.0');
  </script>



  
<a id="gotop" href="#">   
  <span>â–²</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: 'linuxunix' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
   </html>
